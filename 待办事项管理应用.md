---
slug: todo-management-app
title: 待办事项管理应用
date: 2025-01-27
authors: cuiji
tags: [uni-app, nodejs, mongodb, todo, fullstack]
keywords: [待办事项, uni-app, Node.js, MongoDB, 全栈开发, 任务管理]
---

# 待办事项管理应用

一个功能完整的全栈待办事项管理应用，支持任务的增删改查、分类管理、优先级设置、截止日期提醒等功能。项目采用现代化的技术栈，具有良好的用户体验和代码结构。

<!-- truncate -->

---

## 项目概述

### 项目背景

随着生活节奏的加快，人们需要更高效的任务管理工具来提升工作效率。本项目旨在开发一个简洁易用的待办事项管理应用，帮助用户更好地规划和管理日常任务。

### 核心功能

- ✅ 任务的增删改查
- 📂 任务分类管理
- ⭐ 优先级设置
- 📅 截止日期提醒
- 🔍 任务搜索和筛选
- 📊 任务统计和进度跟踪
- 👤 用户认证和权限管理

---

## 技术栈

### 前端技术

- **框架**: uni-app + Vue 3
- **开发语言**: JavaScript/TypeScript
- **UI 组件库**: uView UI / uni-ui
- **状态管理**: Pinia
- **样式**: uni.scss + CSS3
- **HTTP 客户端**: uni.request
- **日期处理**: dayjs
- **图表**: uCharts

### 后端技术

- **云服务**: uniCloud
- **数据库**: uniCloud 云数据库
- **云函数**: Node.js
- **认证**: uni-id
- **文件存储**: uniCloud 云存储
- **推送**: uni-push

### 开发工具

- **IDE**: HBuilderX
- **版本控制**: Git
- **代码规范**: ESLint
- **包管理**: npm/yarn

---

## 需求文档

### 功能需求

#### 1. 用户管理模块

- **用户注册**: 支持邮箱注册，密码强度验证
- **用户登录**: 支持邮箱/用户名登录
- **用户信息**: 个人资料管理，头像上传
- **密码管理**: 密码修改，忘记密码重置

#### 2. 任务管理模块

- **任务创建**: 标题、描述、分类、优先级、截止日期
- **任务编辑**: 修改任务信息，状态更新
- **任务删除**: 单个删除，批量删除
- **任务状态**: 待办、进行中、已完成、已取消

#### 3. 分类管理模块

- **分类创建**: 自定义分类名称和颜色
- **分类编辑**: 修改分类信息
- **分类删除**: 删除分类（需处理关联任务）

#### 4. 搜索和筛选模块

- **关键词搜索**: 按标题、描述搜索任务
- **状态筛选**: 按任务状态筛选
- **分类筛选**: 按任务分类筛选
- **日期筛选**: 按创建时间、截止时间筛选

#### 5. 统计和报表模块

- **任务统计**: 总任务数、完成率、逾期任务数
- **分类统计**: 各分类任务分布
- **时间统计**: 每日、每周、每月任务完成情况
- **进度跟踪**: 任务完成趋势图

### 非功能需求

#### 性能要求

- 页面加载时间 < 2 秒
- 任务列表渲染 < 500ms
- 搜索响应时间 < 300ms

#### 安全要求

- 用户密码加密存储
- JWT token 过期机制
- 输入数据验证和过滤
- XSS 和 CSRF 防护

#### 兼容性要求

- 支持现代浏览器（Chrome 90+, Firefox 88+, Safari 14+）
- 响应式设计，支持移动端访问
- 支持 PWA 功能

---

## 数据库设计

### 用户表 (uni-id-users)

```javascript
{
  _id: ObjectId,
  username: String,        // 用户名，唯一
  email: String,          // 邮箱，唯一
  password: String,       // 加密后的密码
  avatar: String,         // 头像URL
  nickname: String,       // 昵称
  mobile: String,         // 手机号
  status: Number,         // 用户状态：0正常，1禁用
  role: Array,            // 用户角色
  register_date: Date,    // 注册时间
  last_login_date: Date   // 最后登录时间
}
```

### 分类表 (todo-categories)

```javascript
{
  _id: ObjectId,
  name: String,           // 分类名称
  color: String,          // 分类颜色
  icon: String,           // 分类图标
  description: String,    // 分类描述
  user_id: ObjectId,      // 所属用户ID
  is_default: Boolean,    // 是否为默认分类
  sort: Number,           // 排序
  create_date: Date,      // 创建时间
  update_date: Date       // 更新时间
}
```

### 任务表 (todo-tasks)

```javascript
{
  _id: ObjectId,
  title: String,          // 任务标题
  description: String,    // 任务描述
  status: String,         // 任务状态：pending, in_progress, completed, cancelled
  priority: String,       // 优先级：low, medium, high, urgent
  due_date: Date,         // 截止日期
  completed_date: Date,   // 完成时间
  category_id: ObjectId,  // 分类ID
  user_id: ObjectId,      // 所属用户ID
  tags: Array,            // 标签数组
  attachments: Array,     // 附件数组
  subtasks: Array,        // 子任务数组
  create_date: Date,      // 创建时间
  update_date: Date       // 更新时间
}
```

### 用户偏好表 (user-preferences)

```javascript
{
  _id: ObjectId,
  user_id: ObjectId,      // 用户ID
  theme: String,          // 主题偏好：light, dark
  language: String,       // 语言偏好
  notifications: Object,  // 通知设置
  create_date: Date,      // 创建时间
  update_date: Date       // 更新时间
}
```

---

## 云函数接口设计

### 认证相关接口

#### 用户注册

```javascript
// 云函数：user-register
exports.main = async (event, context) => {
  const { username, email, password, nickname } = event;

  try {
    const result = await uniCloud.register({
      username,
      email,
      password,
      nickname,
    });

    return {
      code: 0,
      message: "注册成功",
      data: result,
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### 用户登录

```javascript
// 云函数：user-login
exports.main = async (event, context) => {
  const { email, password } = event;

  try {
    const result = await uniCloud.login({
      email,
      password,
    });

    return {
      code: 0,
      message: "登录成功",
      data: result,
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

### 任务相关接口

#### 获取任务列表

```javascript
// 云函数：task-list
exports.main = async (event, context) => {
  const { page = 1, limit = 10, status, categoryId, search } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    let where = { user_id: userId };

    if (status) where.status = status;
    if (categoryId) where.category_id = categoryId;
    if (search) {
      where.$or = [
        { title: new RegExp(search, "i") },
        { description: new RegExp(search, "i") },
      ];
    }

    const result = await db
      .collection("todo-tasks")
      .where(where)
      .orderBy("create_date", "desc")
      .skip((page - 1) * limit)
      .limit(limit)
      .get();

    const total = await db.collection("todo-tasks").where(where).count();

    return {
      code: 0,
      data: {
        tasks: result.data,
        pagination: {
          page,
          limit,
          total: total.total,
          totalPages: Math.ceil(total.total / limit),
        },
      },
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### 创建任务

```javascript
// 云函数：task-create
exports.main = async (event, context) => {
  const { title, description, categoryId, priority, dueDate, tags } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    const result = await db.collection("todo-tasks").add({
      title,
      description,
      category_id: categoryId,
      priority: priority || "medium",
      due_date: dueDate ? new Date(dueDate) : null,
      tags: tags || [],
      status: "pending",
      user_id: userId,
      create_date: new Date(),
      update_date: new Date(),
    });

    return {
      code: 0,
      message: "任务创建成功",
      data: { taskId: result.id },
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### 更新任务

```javascript
// 云函数：task-update
exports.main = async (event, context) => {
  const { taskId, ...updateData } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    await db
      .collection("todo-tasks")
      .where({
        _id: taskId,
        user_id: userId,
      })
      .update({
        ...updateData,
        update_date: new Date(),
      });

    return {
      code: 0,
      message: "任务更新成功",
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### 删除任务

```javascript
// 云函数：task-delete
exports.main = async (event, context) => {
  const { taskId } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    await db
      .collection("todo-tasks")
      .where({
        _id: taskId,
        user_id: userId,
      })
      .remove();

    return {
      code: 0,
      message: "任务删除成功",
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

### 分类相关接口

#### 获取分类列表

```http
GET /api/categories
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "string",
        "name": "string",
        "color": "string",
        "icon": "string",
        "description": "string",
        "taskCount": 10
      }
    ]
  }
}
```

#### 创建分类

```http
POST /api/categories
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "string",
  "color": "string",
  "icon": "string",
  "description": "string"
}

Response:
{
  "success": true,
  "message": "分类创建成功",
  "data": {
    "category": {
      "id": "string",
      "name": "string",
      "color": "string",
      "icon": "string",
      "description": "string",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  }
}
```

### 统计相关接口

#### 获取任务统计

```http
GET /api/stats/tasks
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "total": 100,
    "completed": 60,
    "pending": 30,
    "inProgress": 8,
    "cancelled": 2,
    "completionRate": 0.6,
    "overdue": 5,
    "dueToday": 3,
    "dueThisWeek": 12
  }
}
```

#### 获取分类统计

```http
GET /api/stats/categories
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "string",
        "name": "string",
        "color": "string",
        "taskCount": 25,
        "completedCount": 15,
        "completionRate": 0.6
      }
    ]
  }
}
```

---

## 前端实现

### 项目结构

```
├── pages/              # 页面文件
│   ├── index/          # 首页
│   ├── login/          # 登录页
│   ├── register/       # 注册页
│   ├── tasks/          # 任务管理
│   ├── categories/     # 分类管理
│   ├── profile/        # 个人资料
│   └── statistics/     # 统计页面
├── components/         # 组件
│   ├── TaskList/       # 任务列表组件
│   ├── TaskForm/       # 任务表单组件
│   ├── CategoryList/   # 分类列表组件
│   └── Common/         # 通用组件
├── store/              # Pinia状态管理
│   ├── modules/        # 模块
│   │   ├── user.js     # 用户模块
│   │   ├── task.js     # 任务模块
│   │   └── category.js # 分类模块
│   └── index.js        # Store入口
├── utils/              # 工具函数
│   ├── request.js      # 请求封装
│   ├── storage.js      # 本地存储
│   └── common.js       # 通用工具
├── static/             # 静态资源
├── uni_modules/        # uni-app插件
├── uniCloud/           # 云函数
├── manifest.json       # 应用配置
├── pages.json          # 页面配置
├── App.vue             # 应用入口
└── main.js             # 主入口文件
```

### 核心组件实现

#### 任务列表组件

```vue
<!-- components/TaskList/TaskList.vue -->
<template>
  <view class="task-list">
    <!-- 搜索和筛选 -->
    <view class="search-bar">
      <u-search
        v-model="searchTerm"
        placeholder="搜索任务..."
        @search="handleSearch"
        @clear="handleClear"
      ></u-search>
      <u-select
        v-model="priorityFilter"
        :options="priorityOptions"
        placeholder="优先级筛选"
        @change="handleFilterChange"
      ></u-select>
    </view>

    <!-- 任务列表 -->
    <view class="task-content">
      <u-loading-page :loading="loading" loading-text="加载中...">
        <view v-if="tasks.length === 0" class="empty-state">
          <u-empty text="暂无任务" mode="data"></u-empty>
        </view>
        <view v-else>
          <view v-for="task in tasks" :key="task._id" class="task-item">
            <u-card :title="task.title" :subtitle="task.description">
              <template #head>
                <view class="task-header">
                  <text class="task-title">{{ task.title }}</text>
                  <view class="task-actions">
                    <u-tag
                      :text="getPriorityText(task.priority)"
                      :type="getPriorityType(task.priority)"
                      size="mini"
                    ></u-tag>
                    <u-tag
                      :text="getStatusText(task.status)"
                      :type="getStatusType(task.status)"
                      size="mini"
                    ></u-tag>
                  </view>
                </view>
              </template>

              <template #body>
                <view class="task-body">
                  <text class="task-desc">{{ task.description }}</text>
                  <view v-if="task.due_date" class="task-due">
                    截止日期: {{ formatDate(task.due_date) }}
                  </view>
                  <view v-if="task.category" class="task-category">
                    <u-tag
                      :text="task.category.name"
                      :color="task.category.color"
                      size="mini"
                    ></u-tag>
                  </view>
                </view>
              </template>

              <template #foot>
                <view class="task-footer">
                  <u-button
                    type="primary"
                    size="mini"
                    @click="handleStatusChange(task._id, 'completed')"
                  >
                    完成
                  </u-button>
                  <u-button
                    type="error"
                    size="mini"
                    @click="handleDelete(task._id)"
                  >
                    删除
                  </u-button>
                </view>
              </template>
            </u-card>
          </view>
        </view>
      </u-loading-page>
    </view>
  </view>
</template>

<script setup>
import { ref, onMounted, computed } from "vue";
import { useTaskStore } from "@/store/modules/task";
import { formatDate } from "@/utils/common";

const props = defineProps({
  categoryId: String,
  status: String,
});

const taskStore = useTaskStore();
const searchTerm = ref("");
const priorityFilter = ref("");
const loading = ref(false);

const tasks = computed(() => taskStore.tasks);

const priorityOptions = [
  { label: "低", value: "low" },
  { label: "中", value: "medium" },
  { label: "高", value: "high" },
  { label: "紧急", value: "urgent" },
];

onMounted(() => {
  loadTasks();
});

const loadTasks = async () => {
  loading.value = true;
  try {
    await taskStore.fetchTasks({
      categoryId: props.categoryId,
      status: props.status,
      search: searchTerm.value,
      priority: priorityFilter.value,
    });
  } finally {
    loading.value = false;
  }
};

const handleSearch = () => {
  loadTasks();
};

const handleClear = () => {
  searchTerm.value = "";
  loadTasks();
};

const handleFilterChange = () => {
  loadTasks();
};

const handleStatusChange = async (taskId, newStatus) => {
  try {
    await taskStore.updateTask({ taskId, status: newStatus });
    uni.showToast({ title: "更新成功", icon: "success" });
    loadTasks();
  } catch (error) {
    uni.showToast({ title: "更新失败", icon: "error" });
  }
};

const handleDelete = async (taskId) => {
  try {
    const res = await uni.showModal({
      title: "确认删除",
      content: "确定要删除这个任务吗？",
    });

    if (res.confirm) {
      await taskStore.deleteTask(taskId);
      uni.showToast({ title: "删除成功", icon: "success" });
      loadTasks();
    }
  } catch (error) {
    uni.showToast({ title: "删除失败", icon: "error" });
  }
};

const getPriorityText = (priority) => {
  const map = { low: "低", medium: "中", high: "高", urgent: "紧急" };
  return map[priority] || "中";
};

const getPriorityType = (priority) => {
  const map = {
    low: "success",
    medium: "warning",
    high: "error",
    urgent: "primary",
  };
  return map[priority] || "warning";
};

const getStatusText = (status) => {
  const map = {
    pending: "待办",
    in_progress: "进行中",
    completed: "已完成",
    cancelled: "已取消",
  };
  return map[status] || "待办";
};

const getStatusType = (status) => {
  const map = {
    pending: "info",
    in_progress: "warning",
    completed: "success",
    cancelled: "error",
  };
  return map[status] || "info";
};
</script>

<style lang="scss" scoped>
.task-list {
  padding: 20rpx;
}

.search-bar {
  display: flex;
  gap: 20rpx;
  margin-bottom: 20rpx;
}

.task-item {
  margin-bottom: 20rpx;
}

.task-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.task-title {
  font-size: 32rpx;
  font-weight: bold;
}

.task-actions {
  display: flex;
  gap: 10rpx;
}

.task-body {
  .task-desc {
    display: block;
    margin-bottom: 10rpx;
    color: #666;
  }

  .task-due {
    font-size: 24rpx;
    color: #999;
    margin-bottom: 10rpx;
  }

  .task-category {
    margin-top: 10rpx;
  }
}

.task-footer {
  display: flex;
  gap: 20rpx;
  justify-content: flex-end;
}

.empty-state {
  padding: 100rpx 0;
  text-align: center;
}
</style>
```

#### 任务表单组件

```vue
<!-- components/TaskForm/TaskForm.vue -->
<template>
  <view class="task-form">
    <u-form ref="formRef" :model="formData" :rules="rules" label-position="top">
      <u-form-item label="任务标题" prop="title">
        <u-input
          v-model="formData.title"
          placeholder="请输入任务标题"
          maxlength="50"
        ></u-input>
      </u-form-item>

      <u-form-item label="任务描述" prop="description">
        <u-textarea
          v-model="formData.description"
          placeholder="请输入任务描述"
          maxlength="200"
          :auto-height="true"
        ></u-textarea>
      </u-form-item>

      <u-form-item label="分类" prop="categoryId">
        <u-select
          v-model="formData.categoryId"
          :options="categoryOptions"
          placeholder="请选择分类"
        ></u-select>
      </u-form-item>

      <u-form-item label="优先级" prop="priority">
        <u-select
          v-model="formData.priority"
          :options="priorityOptions"
          placeholder="请选择优先级"
        ></u-select>
      </u-form-item>

      <u-form-item label="截止日期" prop="dueDate">
        <u-datetime-picker
          v-model="formData.dueDate"
          mode="datetime"
          placeholder="请选择截止日期"
        ></u-datetime-picker>
      </u-form-item>

      <u-form-item label="标签" prop="tags">
        <u-input
          v-model="tagsInput"
          placeholder="输入标签，用逗号分隔"
          @blur="handleTagsChange"
        ></u-input>
        <view v-if="formData.tags.length > 0" class="tags-display">
          <u-tag
            v-for="(tag, index) in formData.tags"
            :key="index"
            :text="tag"
            closable
            @close="removeTag(index)"
          ></u-tag>
        </view>
      </u-form-item>
    </u-form>

    <view class="form-actions">
      <u-button type="primary" :loading="loading" @click="handleSubmit">
        保存
      </u-button>
      <u-button @click="handleCancel"> 取消 </u-button>
    </view>
  </view>
</template>

<script setup>
import { ref, reactive, computed, onMounted, watch } from "vue";
import { useCategoryStore } from "@/store/modules/category";

const props = defineProps({
  initialValues: Object,
  loading: {
    type: Boolean,
    default: false,
  },
});

const emit = defineEmits(["submit", "cancel"]);

const categoryStore = useCategoryStore();
const formRef = ref();
const tagsInput = ref("");

const formData = reactive({
  title: "",
  description: "",
  categoryId: "",
  priority: "medium",
  dueDate: "",
  tags: [],
});

const rules = {
  title: [
    { required: true, message: "请输入任务标题", trigger: "blur" },
    { min: 1, max: 50, message: "标题长度在1到50个字符", trigger: "blur" },
  ],
  categoryId: [{ required: true, message: "请选择分类", trigger: "change" }],
  priority: [{ required: true, message: "请选择优先级", trigger: "change" }],
};

const priorityOptions = [
  { label: "低", value: "low" },
  { label: "中", value: "medium" },
  { label: "高", value: "high" },
  { label: "紧急", value: "urgent" },
];

const categoryOptions = computed(() => {
  return categoryStore.categories.map((category) => ({
    label: category.name,
    value: category._id,
  }));
});

onMounted(() => {
  // 加载分类列表
  categoryStore.fetchCategories();

  // 设置初始值
  if (props.initialValues) {
    Object.assign(formData, props.initialValues);
    if (props.initialValues.tags) {
      formData.tags = [...props.initialValues.tags];
    }
  }
});

const handleTagsChange = () => {
  if (tagsInput.value.trim()) {
    const newTags = tagsInput.value
      .split(",")
      .map((tag) => tag.trim())
      .filter((tag) => tag);
    formData.tags = [...new Set([...formData.tags, ...newTags])];
    tagsInput.value = "";
  }
};

const removeTag = (index) => {
  formData.tags.splice(index, 1);
};

const handleSubmit = async () => {
  try {
    const valid = await formRef.value.validate();
    if (valid) {
      const submitData = {
        ...formData,
        dueDate: formData.dueDate
          ? new Date(formData.dueDate).toISOString()
          : null,
      };
      emit("submit", submitData);
    }
  } catch (error) {
    console.error("表单验证失败:", error);
  }
};

const handleCancel = () => {
  emit("cancel");
};

// 监听初始值变化
watch(
  () => props.initialValues,
  (newVal) => {
    if (newVal) {
      Object.assign(formData, newVal);
      if (newVal.tags) {
        formData.tags = [...newVal.tags];
      }
    }
  },
  { deep: true }
);
</script>

<style lang="scss" scoped>
.task-form {
  padding: 20rpx;
}

.form-actions {
  display: flex;
  gap: 20rpx;
  margin-top: 40rpx;
  justify-content: center;
}

.tags-display {
  display: flex;
  flex-wrap: wrap;
  gap: 10rpx;
  margin-top: 10rpx;
}
</style>
```

### 状态管理实现

#### 任务 Store

```javascript
// store/modules/task.js
import { defineStore } from "pinia";

export const useTaskStore = defineStore("task", {
  state: () => ({
    tasks: [],
    loading: false,
    error: null,
    pagination: {
      page: 1,
      limit: 10,
      total: 0,
      totalPages: 0,
    },
  }),

  getters: {
    pendingTasks: (state) =>
      state.tasks.filter((task) => task.status === "pending"),
    completedTasks: (state) =>
      state.tasks.filter((task) => task.status === "completed"),
    urgentTasks: (state) =>
      state.tasks.filter((task) => task.priority === "urgent"),
    overdueTasks: (state) => {
      const now = new Date();
      return state.tasks.filter(
        (task) =>
          task.due_date &&
          new Date(task.due_date) < now &&
          task.status !== "completed"
      );
    },
  },

  actions: {
    // 获取任务列表
    async fetchTasks(params = {}) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-list",
          data: {
            page: params.page || this.pagination.page,
            limit: params.limit || this.pagination.limit,
            status: params.status,
            categoryId: params.categoryId,
            search: params.search,
            priority: params.priority,
          },
        });

        if (result.result.code === 0) {
          this.tasks = result.result.data.tasks;
          this.pagination = result.result.data.pagination;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "获取任务失败", icon: "error" });
      } finally {
        this.loading = false;
      }
    },

    // 创建任务
    async createTask(taskData) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-create",
          data: taskData,
        });

        if (result.result.code === 0) {
          uni.showToast({ title: "任务创建成功", icon: "success" });
          // 重新获取任务列表
          await this.fetchTasks();
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "创建任务失败", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // 更新任务
    async updateTask({ taskId, ...updateData }) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-update",
          data: {
            taskId,
            ...updateData,
          },
        });

        if (result.result.code === 0) {
          // 更新本地状态
          const index = this.tasks.findIndex((task) => task._id === taskId);
          if (index !== -1) {
            this.tasks[index] = { ...this.tasks[index], ...updateData };
          }
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "更新任务失败", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // 删除任务
    async deleteTask(taskId) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-delete",
          data: { taskId },
        });

        if (result.result.code === 0) {
          // 从本地状态中移除
          this.tasks = this.tasks.filter((task) => task._id !== taskId);
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "删除任务失败", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // 批量删除任务
    async batchDeleteTasks(taskIds) {
      this.loading = true;
      this.error = null;

      try {
        const deletePromises = taskIds.map((taskId) =>
          uniCloud.callFunction({
            name: "task-delete",
            data: { taskId },
          })
        );

        await Promise.all(deletePromises);

        // 从本地状态中移除
        this.tasks = this.tasks.filter((task) => !taskIds.includes(task._id));
        uni.showToast({ title: "批量删除成功", icon: "success" });
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "批量删除失败", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // 清除错误
    clearError() {
      this.error = null;
    },

    // 设置分页
    setPagination(pagination) {
      this.pagination = { ...this.pagination, ...pagination };
    },
  },
});
```

---

## 后端实现

### uniCloud 项目结构

```
uniCloud/
├── cloudfunctions/      # 云函数目录
│   ├── user-register/   # 用户注册云函数
│   ├── user-login/      # 用户登录云函数
│   ├── task-list/       # 任务列表云函数
│   ├── task-create/     # 创建任务云函数
│   ├── task-update/     # 更新任务云函数
│   ├── task-delete/     # 删除任务云函数
│   ├── category-list/   # 分类列表云函数
│   ├── category-create/ # 创建分类云函数
│   └── statistics/      # 统计云函数
├── database/            # 数据库Schema
│   ├── uni-id-users.schema.json      # 用户表
│   ├── todo-tasks.schema.json        # 任务表
│   ├── todo-categories.schema.json   # 分类表
│   └── user-preferences.schema.json  # 用户偏好表
├── common/              # 公共模块
│   ├── uni-config-center/    # 配置中心
│   ├── uni-id-common/        # 用户身份验证
│   └── uni-pay/              # 支付模块
└── client/              # 前端代码
```

### 核心云函数实现

#### 任务列表云函数

```javascript
// cloudfunctions/task-list/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { page = 1, limit = 10, status, categoryId, search, priority } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "用户未登录",
    };
  }

  try {
    // 构建查询条件
    let where = { user_id: userId };

    if (status) where.status = status;
    if (categoryId) where.category_id = categoryId;
    if (priority) where.priority = priority;
    if (search) {
      where.$or = [
        { title: new RegExp(search, "i") },
        { description: new RegExp(search, "i") },
      ];
    }

    // 获取任务列表
    const result = await db
      .collection("todo-tasks")
      .where(where)
      .orderBy("create_date", "desc")
      .skip((page - 1) * limit)
      .limit(limit)
      .get();

    // 获取总数
    const totalResult = await db.collection("todo-tasks").where(where).count();

    // 获取分类信息
    const categoryIds = [
      ...new Set(result.data.map((task) => task.category_id)),
    ];
    const categories = await db
      .collection("todo-categories")
      .where({
        _id: db.command.in(categoryIds),
      })
      .get();

    // 合并分类信息到任务中
    const categoryMap = {};
    categories.data.forEach((category) => {
      categoryMap[category._id] = category;
    });

    result.data = result.data.map((task) => ({
      ...task,
      category: categoryMap[task.category_id],
    }));

    return {
      code: 0,
      data: {
        tasks: result.data,
        pagination: {
          page,
          limit,
          total: totalResult.total,
          totalPages: Math.ceil(totalResult.total / limit),
        },
      },
    };
  } catch (error) {
    console.error("获取任务列表失败:", error);
    return {
      code: -1,
      message: "获取任务列表失败",
    };
  }
};
```

#### 创建任务云函数

```javascript
// cloudfunctions/task-create/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { title, description, categoryId, priority, dueDate, tags } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "用户未登录",
    };
  }

  // 参数验证
  if (!title || !title.trim()) {
    return {
      code: -1,
      message: "任务标题不能为空",
    };
  }

  if (!categoryId) {
    return {
      code: -1,
      message: "请选择分类",
    };
  }

  try {
    // 检查分类是否存在
    const categoryResult = await db
      .collection("todo-categories")
      .where({
        _id: categoryId,
        user_id: userId,
      })
      .get();

    if (categoryResult.data.length === 0) {
      return {
        code: -1,
        message: "分类不存在",
      };
    }

    // 创建任务
    const taskData = {
      title: title.trim(),
      description: description ? description.trim() : "",
      category_id: categoryId,
      priority: priority || "medium",
      due_date: dueDate ? new Date(dueDate) : null,
      tags: tags || [],
      status: "pending",
      user_id: userId,
      create_date: new Date(),
      update_date: new Date(),
    };

    const result = await db.collection("todo-tasks").add(taskData);

    return {
      code: 0,
      message: "任务创建成功",
      data: {
        taskId: result.id,
      },
    };
  } catch (error) {
    console.error("创建任务失败:", error);
    return {
      code: -1,
      message: "创建任务失败",
    };
  }
};
```

#### 统计云函数

```javascript
// cloudfunctions/statistics/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { type } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "用户未登录",
    };
  }

  try {
    let result = {};

    if (type === "tasks" || !type) {
      // 任务统计
      const taskStats = await db
        .collection("todo-tasks")
        .aggregate()
        .match({ user_id: userId })
        .group({
          _id: null,
          total: { $sum: 1 },
          completed: {
            $sum: { $cond: [{ $eq: ["$status", "completed"] }, 1, 0] },
          },
          pending: {
            $sum: { $cond: [{ $eq: ["$status", "pending"] }, 1, 0] },
          },
          in_progress: {
            $sum: { $cond: [{ $eq: ["$status", "in_progress"] }, 1, 0] },
          },
          cancelled: {
            $sum: { $cond: [{ $eq: ["$status", "cancelled"] }, 1, 0] },
          },
        })
        .end();

      const stats = taskStats.data[0] || {
        total: 0,
        completed: 0,
        pending: 0,
        in_progress: 0,
        cancelled: 0,
      };

      // 计算完成率
      stats.completionRate =
        stats.total > 0 ? stats.completed / stats.total : 0;

      // 获取逾期任务
      const now = new Date();
      const overdueResult = await db
        .collection("todo-tasks")
        .where({
          user_id: userId,
          status: db.command.in(["pending", "in_progress"]),
          due_date: db.command.lt(now),
        })
        .count();

      // 获取今日到期任务
      const today = new Date();
      today.setHours(23, 59, 59, 999);
      const dueTodayResult = await db
        .collection("todo-tasks")
        .where({
          user_id: userId,
          status: db.command.in(["pending", "in_progress"]),
          due_date: db.command.lte(today),
        })
        .count();

      result.taskStats = {
        ...stats,
        overdue: overdueResult.total,
        dueToday: dueTodayResult.total,
      };
    }

    if (type === "categories" || !type) {
      // 分类统计
      const categoryStats = await db
        .collection("todo-tasks")
        .aggregate()
        .match({ user_id: userId })
        .group({
          _id: "$category_id",
          taskCount: { $sum: 1 },
          completedCount: {
            $sum: { $cond: [{ $eq: ["$status", "completed"] }, 1, 0] },
          },
        })
        .lookup({
          from: "todo-categories",
          localField: "_id",
          foreignField: "_id",
          as: "category",
        })
        .unwind("$category")
        .addFields({
          completionRate: {
            $cond: [
              { $eq: ["$taskCount", 0] },
              0,
              { $divide: ["$completedCount", "$taskCount"] },
            ],
          },
        })
        .project({
          categoryId: "$_id",
          categoryName: "$category.name",
          categoryColor: "$category.color",
          taskCount: 1,
          completedCount: 1,
          completionRate: 1,
        })
        .end();

      result.categoryStats = categoryStats.data;
    }

    return {
      code: 0,
      data: result,
    };
  } catch (error) {
    console.error("获取统计信息失败:", error);
    return {
      code: -1,
      message: "获取统计信息失败",
    };
  }
};
```

### 数据库 Schema 设计

#### 任务表 Schema

```json
// database/todo-tasks.schema.json
{
  "bsonType": "object",
  "required": ["title", "user_id", "category_id"],
  "properties": {
    "_id": {
      "description": "ID，系统自动生成"
    },
    "title": {
      "bsonType": "string",
      "title": "任务标题",
      "description": "任务标题",
      "minLength": 1,
      "maxLength": 100
    },
    "description": {
      "bsonType": "string",
      "title": "任务描述",
      "description": "任务描述",
      "maxLength": 500
    },
    "status": {
      "bsonType": "string",
      "title": "任务状态",
      "description": "任务状态",
      "enum": ["pending", "in_progress", "completed", "cancelled"],
      "defaultValue": "pending"
    },
    "priority": {
      "bsonType": "string",
      "title": "优先级",
      "description": "任务优先级",
      "enum": ["low", "medium", "high", "urgent"],
      "defaultValue": "medium"
    },
    "due_date": {
      "bsonType": "timestamp",
      "title": "截止日期",
      "description": "任务截止日期"
    },
    "completed_date": {
      "bsonType": "timestamp",
      "title": "完成日期",
      "description": "任务完成日期"
    },
    "category_id": {
      "bsonType": "string",
      "title": "分类ID",
      "description": "任务分类ID",
      "foreignKey": "todo-categories._id"
    },
    "user_id": {
      "bsonType": "string",
      "title": "用户ID",
      "description": "任务所属用户ID",
      "foreignKey": "uni-id-users._id",
      "forceDefaultValue": {
        "$env": "uid"
      }
    },
    "tags": {
      "bsonType": "array",
      "title": "标签",
      "description": "任务标签数组",
      "items": {
        "bsonType": "string"
      }
    },
    "attachments": {
      "bsonType": "array",
      "title": "附件",
      "description": "任务附件数组",
      "items": {
        "bsonType": "object",
        "properties": {
          "name": {
            "bsonType": "string",
            "title": "附件名称"
          },
          "url": {
            "bsonType": "string",
            "title": "附件URL"
          },
          "type": {
            "bsonType": "string",
            "title": "附件类型"
          },
          "size": {
            "bsonType": "int",
            "title": "附件大小"
          }
        }
      }
    },
    "subtasks": {
      "bsonType": "array",
      "title": "子任务",
      "description": "子任务数组",
      "items": {
        "bsonType": "object",
        "properties": {
          "_id": {
            "bsonType": "string",
            "title": "子任务ID"
          },
          "title": {
            "bsonType": "string",
            "title": "子任务标题"
          },
          "completed": {
            "bsonType": "bool",
            "title": "是否完成",
            "defaultValue": false
          },
          "create_date": {
            "bsonType": "timestamp",
            "title": "创建时间",
            "forceDefaultValue": {
              "$env": "now"
            }
          }
        }
      }
    },
    "create_date": {
      "bsonType": "timestamp",
      "title": "创建时间",
      "description": "任务创建时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "update_date": {
      "bsonType": "timestamp",
      "title": "更新时间",
      "description": "任务更新时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  }
}
```

#### 分类表 Schema

```json
// database/todo-categories.schema.json
{
  "bsonType": "object",
  "required": ["name", "user_id"],
  "properties": {
    "_id": {
      "description": "ID，系统自动生成"
    },
    "name": {
      "bsonType": "string",
      "title": "分类名称",
      "description": "分类名称",
      "minLength": 1,
      "maxLength": 50
    },
    "color": {
      "bsonType": "string",
      "title": "分类颜色",
      "description": "分类颜色代码",
      "pattern": "^#[0-9A-Fa-f]{6}$",
      "defaultValue": "#1890ff"
    },
    "icon": {
      "bsonType": "string",
      "title": "分类图标",
      "description": "分类图标名称",
      "defaultValue": "folder"
    },
    "description": {
      "bsonType": "string",
      "title": "分类描述",
      "description": "分类描述",
      "maxLength": 200
    },
    "user_id": {
      "bsonType": "string",
      "title": "用户ID",
      "description": "分类所属用户ID",
      "foreignKey": "uni-id-users._id",
      "forceDefaultValue": {
        "$env": "uid"
      }
    },
    "is_default": {
      "bsonType": "bool",
      "title": "是否默认分类",
      "description": "是否为默认分类",
      "defaultValue": false
    },
    "sort": {
      "bsonType": "int",
      "title": "排序",
      "description": "分类排序",
      "defaultValue": 0
    },
    "create_date": {
      "bsonType": "timestamp",
      "title": "创建时间",
      "description": "分类创建时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "update_date": {
      "bsonType": "timestamp",
      "title": "更新时间",
      "description": "分类更新时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  }
}
```

---

## 部署和配置

### 开发环境配置

#### 1. 创建 uniCloud 服务空间

```bash
# 1. 访问 uniCloud 控制台
https://unicloud.dcloud.net.cn/

# 2. 创建服务空间
# 选择阿里云或腾讯云服务商
# 选择按量付费套餐（有免费额度）

# 3. 获取服务空间ID和访问密钥
```

#### 2. 初始化项目

```bash
# 1. 创建uni-app项目
npx @dcloudio/uvm@latest create my-todo-app

# 2. 进入项目目录
cd my-todo-app

# 3. 关联云服务空间
# 在HBuilderX中右键uniCloud目录 -> 关联云服务空间或项目
```

#### 3. 安装依赖

```bash
# 安装UI组件库
npm install uview-ui

# 安装状态管理
npm install pinia

# 安装其他依赖
npm install dayjs
```

### 云函数部署

#### 1. 上传云函数

```bash
# 在HBuilderX中右键uniCloud/cloudfunctions目录
# 选择"上传所有云函数及公共模块"

# 或者使用命令行
npx @dcloudio/uni-cloud-cli upload
```

#### 2. 初始化数据库

```bash
# 在HBuilderX中右键uniCloud/database目录
# 选择"初始化云数据库"

# 或者手动在uniCloud控制台创建数据表
```

### 前端配置

#### 1. manifest.json 配置

```json
{
  "name": "待办事项管理应用",
  "appid": "__UNI__TODOAPP",
  "description": "一个功能完整的待办事项管理应用",
  "versionName": "1.0.0",
  "versionCode": "100",
  "transformPx": false,
  "app-plus": {
    "usingComponents": true,
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    },
    "modules": {},
    "distribute": {
      "android": {
        "permissions": [
          "<uses-permission android:name=\"android.permission.CHANGE_NETWORK_STATE\" />",
          "<uses-permission android:name=\"android.permission.MOUNT_UNMOUNT_FILESYSTEMS\" />",
          "<uses-permission android:name=\"android.permission.VIBRATE\" />",
          "<uses-permission android:name=\"android.permission.READ_LOGS\" />",
          "<uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\" />",
          "<uses-feature android:name=\"android.hardware.camera.autofocus\" />",
          "<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />",
          "<uses-permission android:name=\"android.permission.CAMERA\" />",
          "<uses-permission android:name=\"android.permission.GET_ACCOUNTS\" />",
          "<uses-permission android:name=\"android.permission.READ_PHONE_STATE\" />",
          "<uses-permission android:name=\"android.permission.CHANGE_WIFI_STATE\" />",
          "<uses-permission android:name=\"android.permission.WAKE_LOCK\" />",
          "<uses-permission android:name=\"android.permission.FLASHLIGHT\" />",
          "<uses-feature android:name=\"android.hardware.camera\" />",
          "<uses-permission android:name=\"android.permission.WRITE_SETTINGS\" />"
        ]
      },
      "ios": {},
      "sdkConfigs": {}
    }
  },
  "quickapp": {},
  "mp-weixin": {
    "appid": "",
    "setting": {
      "urlCheck": false
    },
    "usingComponents": true
  },
  "mp-alipay": {
    "usingComponents": true
  },
  "mp-baidu": {
    "usingComponents": true
  },
  "mp-toutiao": {
    "usingComponents": true
  },
  "uniStatistics": {
    "enable": false
  },
  "h5": {
    "title": "待办事项管理应用",
    "template": "index.html"
  }
}
```

#### 2. pages.json 配置

```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "待办事项",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "pages/login/login",
      "style": {
        "navigationBarTitleText": "登录"
      }
    },
    {
      "path": "pages/register/register",
      "style": {
        "navigationBarTitleText": "注册"
      }
    },
    {
      "path": "pages/tasks/tasks",
      "style": {
        "navigationBarTitleText": "任务管理"
      }
    },
    {
      "path": "pages/categories/categories",
      "style": {
        "navigationBarTitleText": "分类管理"
      }
    },
    {
      "path": "pages/profile/profile",
      "style": {
        "navigationBarTitleText": "个人中心"
      }
    }
  ],
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "待办事项",
    "navigationBarBackgroundColor": "#F8F8F8",
    "backgroundColor": "#F8F8F8"
  },
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#3cc51f",
    "borderStyle": "black",
    "backgroundColor": "#ffffff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "static/tab-home.png",
        "selectedIconPath": "static/tab-home-current.png",
        "text": "首页"
      },
      {
        "pagePath": "pages/tasks/tasks",
        "iconPath": "static/tab-task.png",
        "selectedIconPath": "static/tab-task-current.png",
        "text": "任务"
      },
      {
        "pagePath": "pages/categories/categories",
        "iconPath": "static/tab-category.png",
        "selectedIconPath": "static/tab-category-current.png",
        "text": "分类"
      },
      {
        "pagePath": "pages/profile/profile",
        "iconPath": "static/tab-profile.png",
        "selectedIconPath": "static/tab-profile-current.png",
        "text": "我的"
      }
    ]
  },
  "condition": {
    "current": 0,
    "list": [
      {
        "name": "",
        "path": "",
        "query": ""
      }
    ]
  }
}
```

### 发布配置

#### 1. 微信小程序发布

```bash
# 1. 在微信公众平台注册小程序
# 2. 获取AppID并配置到manifest.json
# 3. 在HBuilderX中选择"发行" -> "小程序-微信"
# 4. 填写AppID并生成小程序包
# 5. 使用微信开发者工具上传代码并提交审核
```

#### 2. H5 发布

```bash
# 1. 在HBuilderX中选择"发行" -> "网站-H5手机版"
# 2. 配置域名和服务器信息
# 3. 上传到服务器或使用CDN
```

#### 3. App 发布

```bash
# 1. 在HBuilderX中选择"发行" -> "原生App-云打包"
# 2. 配置证书和签名
# 3. 选择打包平台（Android/iOS）
# 4. 等待打包完成并下载安装包
```

### 费用说明

#### uniCloud 免费额度

- **阿里云版**：

  - 云函数：100 万次调用/月
  - 云数据库：1GB 存储空间
  - 云存储：5GB 存储空间
  - CDN：5GB 流量/月

- **腾讯云版**：
  - 云函数：100 万次调用/月
  - 云数据库：1GB 存储空间
  - 云存储：5GB 存储空间

#### 超出免费额度后

- 按实际使用量付费
- 云函数：0.0000133 元/次
- 云数据库：0.07 元/GB/天
- 云存储：0.0043 元/GB/天

---

## 项目亮点

### 技术亮点

1. **跨平台开发**: 基于 uni-app，一套代码多端运行（小程序、H5、App）
2. **云原生架构**: 使用 uniCloud 云服务，无需维护服务器
3. **现代化技术栈**: Vue 3 + Pinia + uni-app，开发效率高
4. **组件化设计**: 高度可复用的 Vue 组件
5. **响应式设计**: 完美适配各种屏幕尺寸

### 功能亮点

1. **智能提醒**: 截止日期提醒，逾期任务标记
2. **数据统计**: 任务完成率、分类分布等可视化图表
3. **搜索筛选**: 多维度任务搜索和筛选
4. **批量操作**: 支持批量删除、状态更新
5. **离线缓存**: 支持离线使用，网络恢复后自动同步

### 成本优势

1. **免费额度**: uniCloud 提供丰富的免费额度
2. **按量付费**: 超出免费额度后按实际使用量付费
3. **无需运维**: 云服务自动扩缩容，无需维护服务器
4. **快速部署**: 一键部署到多个平台

### 开发优势

1. **开发效率**: 云端一体化开发，前后端统一技术栈
2. **实时预览**: HBuilderX 提供实时预览功能
3. **丰富生态**: 插件市场提供大量现成组件
4. **文档完善**: 官方文档详细，社区活跃
5. **学习成本低**: 基于 Vue.js，学习曲线平缓

### 部署优势

1. **多端发布**: 一次开发，多端发布
2. **云打包**: 支持云端打包，无需本地配置环境
3. **自动更新**: 支持热更新，无需重新发布
4. **统计分析**: 内置统计分析功能

这个项目展示了现代云原生开发的最佳实践，特别适合个人开发者和小团队快速构建跨平台应用。通过这个项目，可以展示你在前端开发、云服务使用、跨平台开发等多个方面的技术能力，同时具有很好的商业价值和实用价值。
