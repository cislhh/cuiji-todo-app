---
slug: todo-management-app
title: å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨
date: 2025-01-27
authors: cuiji
tags: [uni-app, nodejs, mongodb, todo, fullstack]
keywords: [å¾…åŠäº‹é¡¹, uni-app, Node.js, MongoDB, å…¨æ ˆå¼€å‘, ä»»åŠ¡ç®¡ç†]
---

# å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å…¨æ ˆå¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨ï¼Œæ”¯æŒä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥ã€åˆ†ç±»ç®¡ç†ã€ä¼˜å…ˆçº§è®¾ç½®ã€æˆªæ­¢æ—¥æœŸæé†’ç­‰åŠŸèƒ½ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼Œå…·æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œä»£ç ç»“æ„ã€‚

<!-- truncate -->

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®èƒŒæ™¯

éšç€ç”Ÿæ´»èŠ‚å¥çš„åŠ å¿«ï¼Œäººä»¬éœ€è¦æ›´é«˜æ•ˆçš„ä»»åŠ¡ç®¡ç†å·¥å…·æ¥æå‡å·¥ä½œæ•ˆç‡ã€‚æœ¬é¡¹ç›®æ—¨åœ¨å¼€å‘ä¸€ä¸ªç®€æ´æ˜“ç”¨çš„å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°è§„åˆ’å’Œç®¡ç†æ—¥å¸¸ä»»åŠ¡ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… ä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥
- ğŸ“‚ ä»»åŠ¡åˆ†ç±»ç®¡ç†
- â­ ä¼˜å…ˆçº§è®¾ç½®
- ğŸ“… æˆªæ­¢æ—¥æœŸæé†’
- ğŸ” ä»»åŠ¡æœç´¢å’Œç­›é€‰
- ğŸ“Š ä»»åŠ¡ç»Ÿè®¡å’Œè¿›åº¦è·Ÿè¸ª
- ğŸ‘¤ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯

- **æ¡†æ¶**: uni-app + Vue 3
- **å¼€å‘è¯­è¨€**: JavaScript/TypeScript
- **UI ç»„ä»¶åº“**: uView UI / uni-ui
- **çŠ¶æ€ç®¡ç†**: Pinia
- **æ ·å¼**: uni.scss + CSS3
- **HTTP å®¢æˆ·ç«¯**: uni.request
- **æ—¥æœŸå¤„ç†**: dayjs
- **å›¾è¡¨**: uCharts

### åç«¯æŠ€æœ¯

- **äº‘æœåŠ¡**: uniCloud
- **æ•°æ®åº“**: uniCloud äº‘æ•°æ®åº“
- **äº‘å‡½æ•°**: Node.js
- **è®¤è¯**: uni-id
- **æ–‡ä»¶å­˜å‚¨**: uniCloud äº‘å­˜å‚¨
- **æ¨é€**: uni-push

### å¼€å‘å·¥å…·

- **IDE**: HBuilderX
- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **ä»£ç è§„èŒƒ**: ESLint
- **åŒ…ç®¡ç†**: npm/yarn

---

## éœ€æ±‚æ–‡æ¡£

### åŠŸèƒ½éœ€æ±‚

#### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—

- **ç”¨æˆ·æ³¨å†Œ**: æ”¯æŒé‚®ç®±æ³¨å†Œï¼Œå¯†ç å¼ºåº¦éªŒè¯
- **ç”¨æˆ·ç™»å½•**: æ”¯æŒé‚®ç®±/ç”¨æˆ·åç™»å½•
- **ç”¨æˆ·ä¿¡æ¯**: ä¸ªäººèµ„æ–™ç®¡ç†ï¼Œå¤´åƒä¸Šä¼ 
- **å¯†ç ç®¡ç†**: å¯†ç ä¿®æ”¹ï¼Œå¿˜è®°å¯†ç é‡ç½®

#### 2. ä»»åŠ¡ç®¡ç†æ¨¡å—

- **ä»»åŠ¡åˆ›å»º**: æ ‡é¢˜ã€æè¿°ã€åˆ†ç±»ã€ä¼˜å…ˆçº§ã€æˆªæ­¢æ—¥æœŸ
- **ä»»åŠ¡ç¼–è¾‘**: ä¿®æ”¹ä»»åŠ¡ä¿¡æ¯ï¼ŒçŠ¶æ€æ›´æ–°
- **ä»»åŠ¡åˆ é™¤**: å•ä¸ªåˆ é™¤ï¼Œæ‰¹é‡åˆ é™¤
- **ä»»åŠ¡çŠ¶æ€**: å¾…åŠã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆ

#### 3. åˆ†ç±»ç®¡ç†æ¨¡å—

- **åˆ†ç±»åˆ›å»º**: è‡ªå®šä¹‰åˆ†ç±»åç§°å’Œé¢œè‰²
- **åˆ†ç±»ç¼–è¾‘**: ä¿®æ”¹åˆ†ç±»ä¿¡æ¯
- **åˆ†ç±»åˆ é™¤**: åˆ é™¤åˆ†ç±»ï¼ˆéœ€å¤„ç†å…³è”ä»»åŠ¡ï¼‰

#### 4. æœç´¢å’Œç­›é€‰æ¨¡å—

- **å…³é”®è¯æœç´¢**: æŒ‰æ ‡é¢˜ã€æè¿°æœç´¢ä»»åŠ¡
- **çŠ¶æ€ç­›é€‰**: æŒ‰ä»»åŠ¡çŠ¶æ€ç­›é€‰
- **åˆ†ç±»ç­›é€‰**: æŒ‰ä»»åŠ¡åˆ†ç±»ç­›é€‰
- **æ—¥æœŸç­›é€‰**: æŒ‰åˆ›å»ºæ—¶é—´ã€æˆªæ­¢æ—¶é—´ç­›é€‰

#### 5. ç»Ÿè®¡å’ŒæŠ¥è¡¨æ¨¡å—

- **ä»»åŠ¡ç»Ÿè®¡**: æ€»ä»»åŠ¡æ•°ã€å®Œæˆç‡ã€é€¾æœŸä»»åŠ¡æ•°
- **åˆ†ç±»ç»Ÿè®¡**: å„åˆ†ç±»ä»»åŠ¡åˆ†å¸ƒ
- **æ—¶é—´ç»Ÿè®¡**: æ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆä»»åŠ¡å®Œæˆæƒ…å†µ
- **è¿›åº¦è·Ÿè¸ª**: ä»»åŠ¡å®Œæˆè¶‹åŠ¿å›¾

### éåŠŸèƒ½éœ€æ±‚

#### æ€§èƒ½è¦æ±‚

- é¡µé¢åŠ è½½æ—¶é—´ < 2 ç§’
- ä»»åŠ¡åˆ—è¡¨æ¸²æŸ“ < 500ms
- æœç´¢å“åº”æ—¶é—´ < 300ms

#### å®‰å…¨è¦æ±‚

- ç”¨æˆ·å¯†ç åŠ å¯†å­˜å‚¨
- JWT token è¿‡æœŸæœºåˆ¶
- è¾“å…¥æ•°æ®éªŒè¯å’Œè¿‡æ»¤
- XSS å’Œ CSRF é˜²æŠ¤

#### å…¼å®¹æ€§è¦æ±‚

- æ”¯æŒç°ä»£æµè§ˆå™¨ï¼ˆChrome 90+, Firefox 88+, Safari 14+ï¼‰
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®
- æ”¯æŒ PWA åŠŸèƒ½

---

## æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·è¡¨ (uni-id-users)

```javascript
{
  _id: ObjectId,
  username: String,        // ç”¨æˆ·åï¼Œå”¯ä¸€
  email: String,          // é‚®ç®±ï¼Œå”¯ä¸€
  password: String,       // åŠ å¯†åçš„å¯†ç 
  avatar: String,         // å¤´åƒURL
  nickname: String,       // æ˜µç§°
  mobile: String,         // æ‰‹æœºå·
  status: Number,         // ç”¨æˆ·çŠ¶æ€ï¼š0æ­£å¸¸ï¼Œ1ç¦ç”¨
  role: Array,            // ç”¨æˆ·è§’è‰²
  register_date: Date,    // æ³¨å†Œæ—¶é—´
  last_login_date: Date   // æœ€åç™»å½•æ—¶é—´
}
```

### åˆ†ç±»è¡¨ (todo-categories)

```javascript
{
  _id: ObjectId,
  name: String,           // åˆ†ç±»åç§°
  color: String,          // åˆ†ç±»é¢œè‰²
  icon: String,           // åˆ†ç±»å›¾æ ‡
  description: String,    // åˆ†ç±»æè¿°
  user_id: ObjectId,      // æ‰€å±ç”¨æˆ·ID
  is_default: Boolean,    // æ˜¯å¦ä¸ºé»˜è®¤åˆ†ç±»
  sort: Number,           // æ’åº
  create_date: Date,      // åˆ›å»ºæ—¶é—´
  update_date: Date       // æ›´æ–°æ—¶é—´
}
```

### ä»»åŠ¡è¡¨ (todo-tasks)

```javascript
{
  _id: ObjectId,
  title: String,          // ä»»åŠ¡æ ‡é¢˜
  description: String,    // ä»»åŠ¡æè¿°
  status: String,         // ä»»åŠ¡çŠ¶æ€ï¼špending, in_progress, completed, cancelled
  priority: String,       // ä¼˜å…ˆçº§ï¼šlow, medium, high, urgent
  due_date: Date,         // æˆªæ­¢æ—¥æœŸ
  completed_date: Date,   // å®Œæˆæ—¶é—´
  category_id: ObjectId,  // åˆ†ç±»ID
  user_id: ObjectId,      // æ‰€å±ç”¨æˆ·ID
  tags: Array,            // æ ‡ç­¾æ•°ç»„
  attachments: Array,     // é™„ä»¶æ•°ç»„
  subtasks: Array,        // å­ä»»åŠ¡æ•°ç»„
  create_date: Date,      // åˆ›å»ºæ—¶é—´
  update_date: Date       // æ›´æ–°æ—¶é—´
}
```

### ç”¨æˆ·åå¥½è¡¨ (user-preferences)

```javascript
{
  _id: ObjectId,
  user_id: ObjectId,      // ç”¨æˆ·ID
  theme: String,          // ä¸»é¢˜åå¥½ï¼šlight, dark
  language: String,       // è¯­è¨€åå¥½
  notifications: Object,  // é€šçŸ¥è®¾ç½®
  create_date: Date,      // åˆ›å»ºæ—¶é—´
  update_date: Date       // æ›´æ–°æ—¶é—´
}
```

---

## äº‘å‡½æ•°æ¥å£è®¾è®¡

### è®¤è¯ç›¸å…³æ¥å£

#### ç”¨æˆ·æ³¨å†Œ

```javascript
// äº‘å‡½æ•°ï¼šuser-register
exports.main = async (event, context) => {
  const { username, email, password, nickname } = event;

  try {
    const result = await uniCloud.register({
      username,
      email,
      password,
      nickname,
    });

    return {
      code: 0,
      message: "æ³¨å†ŒæˆåŠŸ",
      data: result,
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### ç”¨æˆ·ç™»å½•

```javascript
// äº‘å‡½æ•°ï¼šuser-login
exports.main = async (event, context) => {
  const { email, password } = event;

  try {
    const result = await uniCloud.login({
      email,
      password,
    });

    return {
      code: 0,
      message: "ç™»å½•æˆåŠŸ",
      data: result,
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

### ä»»åŠ¡ç›¸å…³æ¥å£

#### è·å–ä»»åŠ¡åˆ—è¡¨

```javascript
// äº‘å‡½æ•°ï¼štask-list
exports.main = async (event, context) => {
  const { page = 1, limit = 10, status, categoryId, search } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    let where = { user_id: userId };

    if (status) where.status = status;
    if (categoryId) where.category_id = categoryId;
    if (search) {
      where.$or = [
        { title: new RegExp(search, "i") },
        { description: new RegExp(search, "i") },
      ];
    }

    const result = await db
      .collection("todo-tasks")
      .where(where)
      .orderBy("create_date", "desc")
      .skip((page - 1) * limit)
      .limit(limit)
      .get();

    const total = await db.collection("todo-tasks").where(where).count();

    return {
      code: 0,
      data: {
        tasks: result.data,
        pagination: {
          page,
          limit,
          total: total.total,
          totalPages: Math.ceil(total.total / limit),
        },
      },
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### åˆ›å»ºä»»åŠ¡

```javascript
// äº‘å‡½æ•°ï¼štask-create
exports.main = async (event, context) => {
  const { title, description, categoryId, priority, dueDate, tags } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    const result = await db.collection("todo-tasks").add({
      title,
      description,
      category_id: categoryId,
      priority: priority || "medium",
      due_date: dueDate ? new Date(dueDate) : null,
      tags: tags || [],
      status: "pending",
      user_id: userId,
      create_date: new Date(),
      update_date: new Date(),
    });

    return {
      code: 0,
      message: "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
      data: { taskId: result.id },
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### æ›´æ–°ä»»åŠ¡

```javascript
// äº‘å‡½æ•°ï¼štask-update
exports.main = async (event, context) => {
  const { taskId, ...updateData } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    await db
      .collection("todo-tasks")
      .where({
        _id: taskId,
        user_id: userId,
      })
      .update({
        ...updateData,
        update_date: new Date(),
      });

    return {
      code: 0,
      message: "ä»»åŠ¡æ›´æ–°æˆåŠŸ",
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

#### åˆ é™¤ä»»åŠ¡

```javascript
// äº‘å‡½æ•°ï¼štask-delete
exports.main = async (event, context) => {
  const { taskId } = event;
  const db = uniCloud.database();
  const userId = context.uid;

  try {
    await db
      .collection("todo-tasks")
      .where({
        _id: taskId,
        user_id: userId,
      })
      .remove();

    return {
      code: 0,
      message: "ä»»åŠ¡åˆ é™¤æˆåŠŸ",
    };
  } catch (error) {
    return {
      code: -1,
      message: error.message,
    };
  }
};
```

### åˆ†ç±»ç›¸å…³æ¥å£

#### è·å–åˆ†ç±»åˆ—è¡¨

```http
GET /api/categories
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "string",
        "name": "string",
        "color": "string",
        "icon": "string",
        "description": "string",
        "taskCount": 10
      }
    ]
  }
}
```

#### åˆ›å»ºåˆ†ç±»

```http
POST /api/categories
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "string",
  "color": "string",
  "icon": "string",
  "description": "string"
}

Response:
{
  "success": true,
  "message": "åˆ†ç±»åˆ›å»ºæˆåŠŸ",
  "data": {
    "category": {
      "id": "string",
      "name": "string",
      "color": "string",
      "icon": "string",
      "description": "string",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  }
}
```

### ç»Ÿè®¡ç›¸å…³æ¥å£

#### è·å–ä»»åŠ¡ç»Ÿè®¡

```http
GET /api/stats/tasks
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "total": 100,
    "completed": 60,
    "pending": 30,
    "inProgress": 8,
    "cancelled": 2,
    "completionRate": 0.6,
    "overdue": 5,
    "dueToday": 3,
    "dueThisWeek": 12
  }
}
```

#### è·å–åˆ†ç±»ç»Ÿè®¡

```http
GET /api/stats/categories
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "string",
        "name": "string",
        "color": "string",
        "taskCount": 25,
        "completedCount": 15,
        "completionRate": 0.6
      }
    ]
  }
}
```

---

## å‰ç«¯å®ç°

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ pages/              # é¡µé¢æ–‡ä»¶
â”‚   â”œâ”€â”€ index/          # é¦–é¡µ
â”‚   â”œâ”€â”€ login/          # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ register/       # æ³¨å†Œé¡µ
â”‚   â”œâ”€â”€ tasks/          # ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ categories/     # åˆ†ç±»ç®¡ç†
â”‚   â”œâ”€â”€ profile/        # ä¸ªäººèµ„æ–™
â”‚   â””â”€â”€ statistics/     # ç»Ÿè®¡é¡µé¢
â”œâ”€â”€ components/         # ç»„ä»¶
â”‚   â”œâ”€â”€ TaskList/       # ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ TaskForm/       # ä»»åŠ¡è¡¨å•ç»„ä»¶
â”‚   â”œâ”€â”€ CategoryList/   # åˆ†ç±»åˆ—è¡¨ç»„ä»¶
â”‚   â””â”€â”€ Common/         # é€šç”¨ç»„ä»¶
â”œâ”€â”€ store/              # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ modules/        # æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ user.js     # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ task.js     # ä»»åŠ¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ category.js # åˆ†ç±»æ¨¡å—
â”‚   â””â”€â”€ index.js        # Storeå…¥å£
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ request.js      # è¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ storage.js      # æœ¬åœ°å­˜å‚¨
â”‚   â””â”€â”€ common.js       # é€šç”¨å·¥å…·
â”œâ”€â”€ static/             # é™æ€èµ„æº
â”œâ”€â”€ uni_modules/        # uni-appæ’ä»¶
â”œâ”€â”€ uniCloud/           # äº‘å‡½æ•°
â”œâ”€â”€ manifest.json       # åº”ç”¨é…ç½®
â”œâ”€â”€ pages.json          # é¡µé¢é…ç½®
â”œâ”€â”€ App.vue             # åº”ç”¨å…¥å£
â””â”€â”€ main.js             # ä¸»å…¥å£æ–‡ä»¶
```

### æ ¸å¿ƒç»„ä»¶å®ç°

#### ä»»åŠ¡åˆ—è¡¨ç»„ä»¶

```vue
<!-- components/TaskList/TaskList.vue -->
<template>
  <view class="task-list">
    <!-- æœç´¢å’Œç­›é€‰ -->
    <view class="search-bar">
      <u-search
        v-model="searchTerm"
        placeholder="æœç´¢ä»»åŠ¡..."
        @search="handleSearch"
        @clear="handleClear"
      ></u-search>
      <u-select
        v-model="priorityFilter"
        :options="priorityOptions"
        placeholder="ä¼˜å…ˆçº§ç­›é€‰"
        @change="handleFilterChange"
      ></u-select>
    </view>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <view class="task-content">
      <u-loading-page :loading="loading" loading-text="åŠ è½½ä¸­...">
        <view v-if="tasks.length === 0" class="empty-state">
          <u-empty text="æš‚æ— ä»»åŠ¡" mode="data"></u-empty>
        </view>
        <view v-else>
          <view v-for="task in tasks" :key="task._id" class="task-item">
            <u-card :title="task.title" :subtitle="task.description">
              <template #head>
                <view class="task-header">
                  <text class="task-title">{{ task.title }}</text>
                  <view class="task-actions">
                    <u-tag
                      :text="getPriorityText(task.priority)"
                      :type="getPriorityType(task.priority)"
                      size="mini"
                    ></u-tag>
                    <u-tag
                      :text="getStatusText(task.status)"
                      :type="getStatusType(task.status)"
                      size="mini"
                    ></u-tag>
                  </view>
                </view>
              </template>

              <template #body>
                <view class="task-body">
                  <text class="task-desc">{{ task.description }}</text>
                  <view v-if="task.due_date" class="task-due">
                    æˆªæ­¢æ—¥æœŸ: {{ formatDate(task.due_date) }}
                  </view>
                  <view v-if="task.category" class="task-category">
                    <u-tag
                      :text="task.category.name"
                      :color="task.category.color"
                      size="mini"
                    ></u-tag>
                  </view>
                </view>
              </template>

              <template #foot>
                <view class="task-footer">
                  <u-button
                    type="primary"
                    size="mini"
                    @click="handleStatusChange(task._id, 'completed')"
                  >
                    å®Œæˆ
                  </u-button>
                  <u-button
                    type="error"
                    size="mini"
                    @click="handleDelete(task._id)"
                  >
                    åˆ é™¤
                  </u-button>
                </view>
              </template>
            </u-card>
          </view>
        </view>
      </u-loading-page>
    </view>
  </view>
</template>

<script setup>
import { ref, onMounted, computed } from "vue";
import { useTaskStore } from "@/store/modules/task";
import { formatDate } from "@/utils/common";

const props = defineProps({
  categoryId: String,
  status: String,
});

const taskStore = useTaskStore();
const searchTerm = ref("");
const priorityFilter = ref("");
const loading = ref(false);

const tasks = computed(() => taskStore.tasks);

const priorityOptions = [
  { label: "ä½", value: "low" },
  { label: "ä¸­", value: "medium" },
  { label: "é«˜", value: "high" },
  { label: "ç´§æ€¥", value: "urgent" },
];

onMounted(() => {
  loadTasks();
});

const loadTasks = async () => {
  loading.value = true;
  try {
    await taskStore.fetchTasks({
      categoryId: props.categoryId,
      status: props.status,
      search: searchTerm.value,
      priority: priorityFilter.value,
    });
  } finally {
    loading.value = false;
  }
};

const handleSearch = () => {
  loadTasks();
};

const handleClear = () => {
  searchTerm.value = "";
  loadTasks();
};

const handleFilterChange = () => {
  loadTasks();
};

const handleStatusChange = async (taskId, newStatus) => {
  try {
    await taskStore.updateTask({ taskId, status: newStatus });
    uni.showToast({ title: "æ›´æ–°æˆåŠŸ", icon: "success" });
    loadTasks();
  } catch (error) {
    uni.showToast({ title: "æ›´æ–°å¤±è´¥", icon: "error" });
  }
};

const handleDelete = async (taskId) => {
  try {
    const res = await uni.showModal({
      title: "ç¡®è®¤åˆ é™¤",
      content: "ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ",
    });

    if (res.confirm) {
      await taskStore.deleteTask(taskId);
      uni.showToast({ title: "åˆ é™¤æˆåŠŸ", icon: "success" });
      loadTasks();
    }
  } catch (error) {
    uni.showToast({ title: "åˆ é™¤å¤±è´¥", icon: "error" });
  }
};

const getPriorityText = (priority) => {
  const map = { low: "ä½", medium: "ä¸­", high: "é«˜", urgent: "ç´§æ€¥" };
  return map[priority] || "ä¸­";
};

const getPriorityType = (priority) => {
  const map = {
    low: "success",
    medium: "warning",
    high: "error",
    urgent: "primary",
  };
  return map[priority] || "warning";
};

const getStatusText = (status) => {
  const map = {
    pending: "å¾…åŠ",
    in_progress: "è¿›è¡Œä¸­",
    completed: "å·²å®Œæˆ",
    cancelled: "å·²å–æ¶ˆ",
  };
  return map[status] || "å¾…åŠ";
};

const getStatusType = (status) => {
  const map = {
    pending: "info",
    in_progress: "warning",
    completed: "success",
    cancelled: "error",
  };
  return map[status] || "info";
};
</script>

<style lang="scss" scoped>
.task-list {
  padding: 20rpx;
}

.search-bar {
  display: flex;
  gap: 20rpx;
  margin-bottom: 20rpx;
}

.task-item {
  margin-bottom: 20rpx;
}

.task-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.task-title {
  font-size: 32rpx;
  font-weight: bold;
}

.task-actions {
  display: flex;
  gap: 10rpx;
}

.task-body {
  .task-desc {
    display: block;
    margin-bottom: 10rpx;
    color: #666;
  }

  .task-due {
    font-size: 24rpx;
    color: #999;
    margin-bottom: 10rpx;
  }

  .task-category {
    margin-top: 10rpx;
  }
}

.task-footer {
  display: flex;
  gap: 20rpx;
  justify-content: flex-end;
}

.empty-state {
  padding: 100rpx 0;
  text-align: center;
}
</style>
```

#### ä»»åŠ¡è¡¨å•ç»„ä»¶

```vue
<!-- components/TaskForm/TaskForm.vue -->
<template>
  <view class="task-form">
    <u-form ref="formRef" :model="formData" :rules="rules" label-position="top">
      <u-form-item label="ä»»åŠ¡æ ‡é¢˜" prop="title">
        <u-input
          v-model="formData.title"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜"
          maxlength="50"
        ></u-input>
      </u-form-item>

      <u-form-item label="ä»»åŠ¡æè¿°" prop="description">
        <u-textarea
          v-model="formData.description"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°"
          maxlength="200"
          :auto-height="true"
        ></u-textarea>
      </u-form-item>

      <u-form-item label="åˆ†ç±»" prop="categoryId">
        <u-select
          v-model="formData.categoryId"
          :options="categoryOptions"
          placeholder="è¯·é€‰æ‹©åˆ†ç±»"
        ></u-select>
      </u-form-item>

      <u-form-item label="ä¼˜å…ˆçº§" prop="priority">
        <u-select
          v-model="formData.priority"
          :options="priorityOptions"
          placeholder="è¯·é€‰æ‹©ä¼˜å…ˆçº§"
        ></u-select>
      </u-form-item>

      <u-form-item label="æˆªæ­¢æ—¥æœŸ" prop="dueDate">
        <u-datetime-picker
          v-model="formData.dueDate"
          mode="datetime"
          placeholder="è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ"
        ></u-datetime-picker>
      </u-form-item>

      <u-form-item label="æ ‡ç­¾" prop="tags">
        <u-input
          v-model="tagsInput"
          placeholder="è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”"
          @blur="handleTagsChange"
        ></u-input>
        <view v-if="formData.tags.length > 0" class="tags-display">
          <u-tag
            v-for="(tag, index) in formData.tags"
            :key="index"
            :text="tag"
            closable
            @close="removeTag(index)"
          ></u-tag>
        </view>
      </u-form-item>
    </u-form>

    <view class="form-actions">
      <u-button type="primary" :loading="loading" @click="handleSubmit">
        ä¿å­˜
      </u-button>
      <u-button @click="handleCancel"> å–æ¶ˆ </u-button>
    </view>
  </view>
</template>

<script setup>
import { ref, reactive, computed, onMounted, watch } from "vue";
import { useCategoryStore } from "@/store/modules/category";

const props = defineProps({
  initialValues: Object,
  loading: {
    type: Boolean,
    default: false,
  },
});

const emit = defineEmits(["submit", "cancel"]);

const categoryStore = useCategoryStore();
const formRef = ref();
const tagsInput = ref("");

const formData = reactive({
  title: "",
  description: "",
  categoryId: "",
  priority: "medium",
  dueDate: "",
  tags: [],
});

const rules = {
  title: [
    { required: true, message: "è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜", trigger: "blur" },
    { min: 1, max: 50, message: "æ ‡é¢˜é•¿åº¦åœ¨1åˆ°50ä¸ªå­—ç¬¦", trigger: "blur" },
  ],
  categoryId: [{ required: true, message: "è¯·é€‰æ‹©åˆ†ç±»", trigger: "change" }],
  priority: [{ required: true, message: "è¯·é€‰æ‹©ä¼˜å…ˆçº§", trigger: "change" }],
};

const priorityOptions = [
  { label: "ä½", value: "low" },
  { label: "ä¸­", value: "medium" },
  { label: "é«˜", value: "high" },
  { label: "ç´§æ€¥", value: "urgent" },
];

const categoryOptions = computed(() => {
  return categoryStore.categories.map((category) => ({
    label: category.name,
    value: category._id,
  }));
});

onMounted(() => {
  // åŠ è½½åˆ†ç±»åˆ—è¡¨
  categoryStore.fetchCategories();

  // è®¾ç½®åˆå§‹å€¼
  if (props.initialValues) {
    Object.assign(formData, props.initialValues);
    if (props.initialValues.tags) {
      formData.tags = [...props.initialValues.tags];
    }
  }
});

const handleTagsChange = () => {
  if (tagsInput.value.trim()) {
    const newTags = tagsInput.value
      .split(",")
      .map((tag) => tag.trim())
      .filter((tag) => tag);
    formData.tags = [...new Set([...formData.tags, ...newTags])];
    tagsInput.value = "";
  }
};

const removeTag = (index) => {
  formData.tags.splice(index, 1);
};

const handleSubmit = async () => {
  try {
    const valid = await formRef.value.validate();
    if (valid) {
      const submitData = {
        ...formData,
        dueDate: formData.dueDate
          ? new Date(formData.dueDate).toISOString()
          : null,
      };
      emit("submit", submitData);
    }
  } catch (error) {
    console.error("è¡¨å•éªŒè¯å¤±è´¥:", error);
  }
};

const handleCancel = () => {
  emit("cancel");
};

// ç›‘å¬åˆå§‹å€¼å˜åŒ–
watch(
  () => props.initialValues,
  (newVal) => {
    if (newVal) {
      Object.assign(formData, newVal);
      if (newVal.tags) {
        formData.tags = [...newVal.tags];
      }
    }
  },
  { deep: true }
);
</script>

<style lang="scss" scoped>
.task-form {
  padding: 20rpx;
}

.form-actions {
  display: flex;
  gap: 20rpx;
  margin-top: 40rpx;
  justify-content: center;
}

.tags-display {
  display: flex;
  flex-wrap: wrap;
  gap: 10rpx;
  margin-top: 10rpx;
}
</style>
```

### çŠ¶æ€ç®¡ç†å®ç°

#### ä»»åŠ¡ Store

```javascript
// store/modules/task.js
import { defineStore } from "pinia";

export const useTaskStore = defineStore("task", {
  state: () => ({
    tasks: [],
    loading: false,
    error: null,
    pagination: {
      page: 1,
      limit: 10,
      total: 0,
      totalPages: 0,
    },
  }),

  getters: {
    pendingTasks: (state) =>
      state.tasks.filter((task) => task.status === "pending"),
    completedTasks: (state) =>
      state.tasks.filter((task) => task.status === "completed"),
    urgentTasks: (state) =>
      state.tasks.filter((task) => task.priority === "urgent"),
    overdueTasks: (state) => {
      const now = new Date();
      return state.tasks.filter(
        (task) =>
          task.due_date &&
          new Date(task.due_date) < now &&
          task.status !== "completed"
      );
    },
  },

  actions: {
    // è·å–ä»»åŠ¡åˆ—è¡¨
    async fetchTasks(params = {}) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-list",
          data: {
            page: params.page || this.pagination.page,
            limit: params.limit || this.pagination.limit,
            status: params.status,
            categoryId: params.categoryId,
            search: params.search,
            priority: params.priority,
          },
        });

        if (result.result.code === 0) {
          this.tasks = result.result.data.tasks;
          this.pagination = result.result.data.pagination;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "è·å–ä»»åŠ¡å¤±è´¥", icon: "error" });
      } finally {
        this.loading = false;
      }
    },

    // åˆ›å»ºä»»åŠ¡
    async createTask(taskData) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-create",
          data: taskData,
        });

        if (result.result.code === 0) {
          uni.showToast({ title: "ä»»åŠ¡åˆ›å»ºæˆåŠŸ", icon: "success" });
          // é‡æ–°è·å–ä»»åŠ¡åˆ—è¡¨
          await this.fetchTasks();
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "åˆ›å»ºä»»åŠ¡å¤±è´¥", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // æ›´æ–°ä»»åŠ¡
    async updateTask({ taskId, ...updateData }) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-update",
          data: {
            taskId,
            ...updateData,
          },
        });

        if (result.result.code === 0) {
          // æ›´æ–°æœ¬åœ°çŠ¶æ€
          const index = this.tasks.findIndex((task) => task._id === taskId);
          if (index !== -1) {
            this.tasks[index] = { ...this.tasks[index], ...updateData };
          }
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "æ›´æ–°ä»»åŠ¡å¤±è´¥", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // åˆ é™¤ä»»åŠ¡
    async deleteTask(taskId) {
      this.loading = true;
      this.error = null;

      try {
        const result = await uniCloud.callFunction({
          name: "task-delete",
          data: { taskId },
        });

        if (result.result.code === 0) {
          // ä»æœ¬åœ°çŠ¶æ€ä¸­ç§»é™¤
          this.tasks = this.tasks.filter((task) => task._id !== taskId);
          return result.result.data;
        } else {
          throw new Error(result.result.message);
        }
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "åˆ é™¤ä»»åŠ¡å¤±è´¥", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // æ‰¹é‡åˆ é™¤ä»»åŠ¡
    async batchDeleteTasks(taskIds) {
      this.loading = true;
      this.error = null;

      try {
        const deletePromises = taskIds.map((taskId) =>
          uniCloud.callFunction({
            name: "task-delete",
            data: { taskId },
          })
        );

        await Promise.all(deletePromises);

        // ä»æœ¬åœ°çŠ¶æ€ä¸­ç§»é™¤
        this.tasks = this.tasks.filter((task) => !taskIds.includes(task._id));
        uni.showToast({ title: "æ‰¹é‡åˆ é™¤æˆåŠŸ", icon: "success" });
      } catch (error) {
        this.error = error.message;
        uni.showToast({ title: "æ‰¹é‡åˆ é™¤å¤±è´¥", icon: "error" });
        throw error;
      } finally {
        this.loading = false;
      }
    },

    // æ¸…é™¤é”™è¯¯
    clearError() {
      this.error = null;
    },

    // è®¾ç½®åˆ†é¡µ
    setPagination(pagination) {
      this.pagination = { ...this.pagination, ...pagination };
    },
  },
});
```

---

## åç«¯å®ç°

### uniCloud é¡¹ç›®ç»“æ„

```
uniCloud/
â”œâ”€â”€ cloudfunctions/      # äº‘å‡½æ•°ç›®å½•
â”‚   â”œâ”€â”€ user-register/   # ç”¨æˆ·æ³¨å†Œäº‘å‡½æ•°
â”‚   â”œâ”€â”€ user-login/      # ç”¨æˆ·ç™»å½•äº‘å‡½æ•°
â”‚   â”œâ”€â”€ task-list/       # ä»»åŠ¡åˆ—è¡¨äº‘å‡½æ•°
â”‚   â”œâ”€â”€ task-create/     # åˆ›å»ºä»»åŠ¡äº‘å‡½æ•°
â”‚   â”œâ”€â”€ task-update/     # æ›´æ–°ä»»åŠ¡äº‘å‡½æ•°
â”‚   â”œâ”€â”€ task-delete/     # åˆ é™¤ä»»åŠ¡äº‘å‡½æ•°
â”‚   â”œâ”€â”€ category-list/   # åˆ†ç±»åˆ—è¡¨äº‘å‡½æ•°
â”‚   â”œâ”€â”€ category-create/ # åˆ›å»ºåˆ†ç±»äº‘å‡½æ•°
â”‚   â””â”€â”€ statistics/      # ç»Ÿè®¡äº‘å‡½æ•°
â”œâ”€â”€ database/            # æ•°æ®åº“Schema
â”‚   â”œâ”€â”€ uni-id-users.schema.json      # ç”¨æˆ·è¡¨
â”‚   â”œâ”€â”€ todo-tasks.schema.json        # ä»»åŠ¡è¡¨
â”‚   â”œâ”€â”€ todo-categories.schema.json   # åˆ†ç±»è¡¨
â”‚   â””â”€â”€ user-preferences.schema.json  # ç”¨æˆ·åå¥½è¡¨
â”œâ”€â”€ common/              # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ uni-config-center/    # é…ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ uni-id-common/        # ç”¨æˆ·èº«ä»½éªŒè¯
â”‚   â””â”€â”€ uni-pay/              # æ”¯ä»˜æ¨¡å—
â””â”€â”€ client/              # å‰ç«¯ä»£ç 
```

### æ ¸å¿ƒäº‘å‡½æ•°å®ç°

#### ä»»åŠ¡åˆ—è¡¨äº‘å‡½æ•°

```javascript
// cloudfunctions/task-list/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { page = 1, limit = 10, status, categoryId, search, priority } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "ç”¨æˆ·æœªç™»å½•",
    };
  }

  try {
    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
    let where = { user_id: userId };

    if (status) where.status = status;
    if (categoryId) where.category_id = categoryId;
    if (priority) where.priority = priority;
    if (search) {
      where.$or = [
        { title: new RegExp(search, "i") },
        { description: new RegExp(search, "i") },
      ];
    }

    // è·å–ä»»åŠ¡åˆ—è¡¨
    const result = await db
      .collection("todo-tasks")
      .where(where)
      .orderBy("create_date", "desc")
      .skip((page - 1) * limit)
      .limit(limit)
      .get();

    // è·å–æ€»æ•°
    const totalResult = await db.collection("todo-tasks").where(where).count();

    // è·å–åˆ†ç±»ä¿¡æ¯
    const categoryIds = [
      ...new Set(result.data.map((task) => task.category_id)),
    ];
    const categories = await db
      .collection("todo-categories")
      .where({
        _id: db.command.in(categoryIds),
      })
      .get();

    // åˆå¹¶åˆ†ç±»ä¿¡æ¯åˆ°ä»»åŠ¡ä¸­
    const categoryMap = {};
    categories.data.forEach((category) => {
      categoryMap[category._id] = category;
    });

    result.data = result.data.map((task) => ({
      ...task,
      category: categoryMap[task.category_id],
    }));

    return {
      code: 0,
      data: {
        tasks: result.data,
        pagination: {
          page,
          limit,
          total: totalResult.total,
          totalPages: Math.ceil(totalResult.total / limit),
        },
      },
    };
  } catch (error) {
    console.error("è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥:", error);
    return {
      code: -1,
      message: "è·å–ä»»åŠ¡åˆ—è¡¨å¤±è´¥",
    };
  }
};
```

#### åˆ›å»ºä»»åŠ¡äº‘å‡½æ•°

```javascript
// cloudfunctions/task-create/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { title, description, categoryId, priority, dueDate, tags } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "ç”¨æˆ·æœªç™»å½•",
    };
  }

  // å‚æ•°éªŒè¯
  if (!title || !title.trim()) {
    return {
      code: -1,
      message: "ä»»åŠ¡æ ‡é¢˜ä¸èƒ½ä¸ºç©º",
    };
  }

  if (!categoryId) {
    return {
      code: -1,
      message: "è¯·é€‰æ‹©åˆ†ç±»",
    };
  }

  try {
    // æ£€æŸ¥åˆ†ç±»æ˜¯å¦å­˜åœ¨
    const categoryResult = await db
      .collection("todo-categories")
      .where({
        _id: categoryId,
        user_id: userId,
      })
      .get();

    if (categoryResult.data.length === 0) {
      return {
        code: -1,
        message: "åˆ†ç±»ä¸å­˜åœ¨",
      };
    }

    // åˆ›å»ºä»»åŠ¡
    const taskData = {
      title: title.trim(),
      description: description ? description.trim() : "",
      category_id: categoryId,
      priority: priority || "medium",
      due_date: dueDate ? new Date(dueDate) : null,
      tags: tags || [],
      status: "pending",
      user_id: userId,
      create_date: new Date(),
      update_date: new Date(),
    };

    const result = await db.collection("todo-tasks").add(taskData);

    return {
      code: 0,
      message: "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
      data: {
        taskId: result.id,
      },
    };
  } catch (error) {
    console.error("åˆ›å»ºä»»åŠ¡å¤±è´¥:", error);
    return {
      code: -1,
      message: "åˆ›å»ºä»»åŠ¡å¤±è´¥",
    };
  }
};
```

#### ç»Ÿè®¡äº‘å‡½æ•°

```javascript
// cloudfunctions/statistics/index.js
"use strict";

const db = uniCloud.database();

exports.main = async (event, context) => {
  const { type } = event;
  const userId = context.uid;

  if (!userId) {
    return {
      code: -1,
      message: "ç”¨æˆ·æœªç™»å½•",
    };
  }

  try {
    let result = {};

    if (type === "tasks" || !type) {
      // ä»»åŠ¡ç»Ÿè®¡
      const taskStats = await db
        .collection("todo-tasks")
        .aggregate()
        .match({ user_id: userId })
        .group({
          _id: null,
          total: { $sum: 1 },
          completed: {
            $sum: { $cond: [{ $eq: ["$status", "completed"] }, 1, 0] },
          },
          pending: {
            $sum: { $cond: [{ $eq: ["$status", "pending"] }, 1, 0] },
          },
          in_progress: {
            $sum: { $cond: [{ $eq: ["$status", "in_progress"] }, 1, 0] },
          },
          cancelled: {
            $sum: { $cond: [{ $eq: ["$status", "cancelled"] }, 1, 0] },
          },
        })
        .end();

      const stats = taskStats.data[0] || {
        total: 0,
        completed: 0,
        pending: 0,
        in_progress: 0,
        cancelled: 0,
      };

      // è®¡ç®—å®Œæˆç‡
      stats.completionRate =
        stats.total > 0 ? stats.completed / stats.total : 0;

      // è·å–é€¾æœŸä»»åŠ¡
      const now = new Date();
      const overdueResult = await db
        .collection("todo-tasks")
        .where({
          user_id: userId,
          status: db.command.in(["pending", "in_progress"]),
          due_date: db.command.lt(now),
        })
        .count();

      // è·å–ä»Šæ—¥åˆ°æœŸä»»åŠ¡
      const today = new Date();
      today.setHours(23, 59, 59, 999);
      const dueTodayResult = await db
        .collection("todo-tasks")
        .where({
          user_id: userId,
          status: db.command.in(["pending", "in_progress"]),
          due_date: db.command.lte(today),
        })
        .count();

      result.taskStats = {
        ...stats,
        overdue: overdueResult.total,
        dueToday: dueTodayResult.total,
      };
    }

    if (type === "categories" || !type) {
      // åˆ†ç±»ç»Ÿè®¡
      const categoryStats = await db
        .collection("todo-tasks")
        .aggregate()
        .match({ user_id: userId })
        .group({
          _id: "$category_id",
          taskCount: { $sum: 1 },
          completedCount: {
            $sum: { $cond: [{ $eq: ["$status", "completed"] }, 1, 0] },
          },
        })
        .lookup({
          from: "todo-categories",
          localField: "_id",
          foreignField: "_id",
          as: "category",
        })
        .unwind("$category")
        .addFields({
          completionRate: {
            $cond: [
              { $eq: ["$taskCount", 0] },
              0,
              { $divide: ["$completedCount", "$taskCount"] },
            ],
          },
        })
        .project({
          categoryId: "$_id",
          categoryName: "$category.name",
          categoryColor: "$category.color",
          taskCount: 1,
          completedCount: 1,
          completionRate: 1,
        })
        .end();

      result.categoryStats = categoryStats.data;
    }

    return {
      code: 0,
      data: result,
    };
  } catch (error) {
    console.error("è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:", error);
    return {
      code: -1,
      message: "è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥",
    };
  }
};
```

### æ•°æ®åº“ Schema è®¾è®¡

#### ä»»åŠ¡è¡¨ Schema

```json
// database/todo-tasks.schema.json
{
  "bsonType": "object",
  "required": ["title", "user_id", "category_id"],
  "properties": {
    "_id": {
      "description": "IDï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ"
    },
    "title": {
      "bsonType": "string",
      "title": "ä»»åŠ¡æ ‡é¢˜",
      "description": "ä»»åŠ¡æ ‡é¢˜",
      "minLength": 1,
      "maxLength": 100
    },
    "description": {
      "bsonType": "string",
      "title": "ä»»åŠ¡æè¿°",
      "description": "ä»»åŠ¡æè¿°",
      "maxLength": 500
    },
    "status": {
      "bsonType": "string",
      "title": "ä»»åŠ¡çŠ¶æ€",
      "description": "ä»»åŠ¡çŠ¶æ€",
      "enum": ["pending", "in_progress", "completed", "cancelled"],
      "defaultValue": "pending"
    },
    "priority": {
      "bsonType": "string",
      "title": "ä¼˜å…ˆçº§",
      "description": "ä»»åŠ¡ä¼˜å…ˆçº§",
      "enum": ["low", "medium", "high", "urgent"],
      "defaultValue": "medium"
    },
    "due_date": {
      "bsonType": "timestamp",
      "title": "æˆªæ­¢æ—¥æœŸ",
      "description": "ä»»åŠ¡æˆªæ­¢æ—¥æœŸ"
    },
    "completed_date": {
      "bsonType": "timestamp",
      "title": "å®Œæˆæ—¥æœŸ",
      "description": "ä»»åŠ¡å®Œæˆæ—¥æœŸ"
    },
    "category_id": {
      "bsonType": "string",
      "title": "åˆ†ç±»ID",
      "description": "ä»»åŠ¡åˆ†ç±»ID",
      "foreignKey": "todo-categories._id"
    },
    "user_id": {
      "bsonType": "string",
      "title": "ç”¨æˆ·ID",
      "description": "ä»»åŠ¡æ‰€å±ç”¨æˆ·ID",
      "foreignKey": "uni-id-users._id",
      "forceDefaultValue": {
        "$env": "uid"
      }
    },
    "tags": {
      "bsonType": "array",
      "title": "æ ‡ç­¾",
      "description": "ä»»åŠ¡æ ‡ç­¾æ•°ç»„",
      "items": {
        "bsonType": "string"
      }
    },
    "attachments": {
      "bsonType": "array",
      "title": "é™„ä»¶",
      "description": "ä»»åŠ¡é™„ä»¶æ•°ç»„",
      "items": {
        "bsonType": "object",
        "properties": {
          "name": {
            "bsonType": "string",
            "title": "é™„ä»¶åç§°"
          },
          "url": {
            "bsonType": "string",
            "title": "é™„ä»¶URL"
          },
          "type": {
            "bsonType": "string",
            "title": "é™„ä»¶ç±»å‹"
          },
          "size": {
            "bsonType": "int",
            "title": "é™„ä»¶å¤§å°"
          }
        }
      }
    },
    "subtasks": {
      "bsonType": "array",
      "title": "å­ä»»åŠ¡",
      "description": "å­ä»»åŠ¡æ•°ç»„",
      "items": {
        "bsonType": "object",
        "properties": {
          "_id": {
            "bsonType": "string",
            "title": "å­ä»»åŠ¡ID"
          },
          "title": {
            "bsonType": "string",
            "title": "å­ä»»åŠ¡æ ‡é¢˜"
          },
          "completed": {
            "bsonType": "bool",
            "title": "æ˜¯å¦å®Œæˆ",
            "defaultValue": false
          },
          "create_date": {
            "bsonType": "timestamp",
            "title": "åˆ›å»ºæ—¶é—´",
            "forceDefaultValue": {
              "$env": "now"
            }
          }
        }
      }
    },
    "create_date": {
      "bsonType": "timestamp",
      "title": "åˆ›å»ºæ—¶é—´",
      "description": "ä»»åŠ¡åˆ›å»ºæ—¶é—´",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "update_date": {
      "bsonType": "timestamp",
      "title": "æ›´æ–°æ—¶é—´",
      "description": "ä»»åŠ¡æ›´æ–°æ—¶é—´",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  }
}
```

#### åˆ†ç±»è¡¨ Schema

```json
// database/todo-categories.schema.json
{
  "bsonType": "object",
  "required": ["name", "user_id"],
  "properties": {
    "_id": {
      "description": "IDï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ"
    },
    "name": {
      "bsonType": "string",
      "title": "åˆ†ç±»åç§°",
      "description": "åˆ†ç±»åç§°",
      "minLength": 1,
      "maxLength": 50
    },
    "color": {
      "bsonType": "string",
      "title": "åˆ†ç±»é¢œè‰²",
      "description": "åˆ†ç±»é¢œè‰²ä»£ç ",
      "pattern": "^#[0-9A-Fa-f]{6}$",
      "defaultValue": "#1890ff"
    },
    "icon": {
      "bsonType": "string",
      "title": "åˆ†ç±»å›¾æ ‡",
      "description": "åˆ†ç±»å›¾æ ‡åç§°",
      "defaultValue": "folder"
    },
    "description": {
      "bsonType": "string",
      "title": "åˆ†ç±»æè¿°",
      "description": "åˆ†ç±»æè¿°",
      "maxLength": 200
    },
    "user_id": {
      "bsonType": "string",
      "title": "ç”¨æˆ·ID",
      "description": "åˆ†ç±»æ‰€å±ç”¨æˆ·ID",
      "foreignKey": "uni-id-users._id",
      "forceDefaultValue": {
        "$env": "uid"
      }
    },
    "is_default": {
      "bsonType": "bool",
      "title": "æ˜¯å¦é»˜è®¤åˆ†ç±»",
      "description": "æ˜¯å¦ä¸ºé»˜è®¤åˆ†ç±»",
      "defaultValue": false
    },
    "sort": {
      "bsonType": "int",
      "title": "æ’åº",
      "description": "åˆ†ç±»æ’åº",
      "defaultValue": 0
    },
    "create_date": {
      "bsonType": "timestamp",
      "title": "åˆ›å»ºæ—¶é—´",
      "description": "åˆ†ç±»åˆ›å»ºæ—¶é—´",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "update_date": {
      "bsonType": "timestamp",
      "title": "æ›´æ–°æ—¶é—´",
      "description": "åˆ†ç±»æ›´æ–°æ—¶é—´",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  }
}
```

---

## éƒ¨ç½²å’Œé…ç½®

### å¼€å‘ç¯å¢ƒé…ç½®

#### 1. åˆ›å»º uniCloud æœåŠ¡ç©ºé—´

```bash
# 1. è®¿é—® uniCloud æ§åˆ¶å°
https://unicloud.dcloud.net.cn/

# 2. åˆ›å»ºæœåŠ¡ç©ºé—´
# é€‰æ‹©é˜¿é‡Œäº‘æˆ–è…¾è®¯äº‘æœåŠ¡å•†
# é€‰æ‹©æŒ‰é‡ä»˜è´¹å¥—é¤ï¼ˆæœ‰å…è´¹é¢åº¦ï¼‰

# 3. è·å–æœåŠ¡ç©ºé—´IDå’Œè®¿é—®å¯†é’¥
```

#### 2. åˆå§‹åŒ–é¡¹ç›®

```bash
# 1. åˆ›å»ºuni-appé¡¹ç›®
npx @dcloudio/uvm@latest create my-todo-app

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd my-todo-app

# 3. å…³è”äº‘æœåŠ¡ç©ºé—´
# åœ¨HBuilderXä¸­å³é”®uniCloudç›®å½• -> å…³è”äº‘æœåŠ¡ç©ºé—´æˆ–é¡¹ç›®
```

#### 3. å®‰è£…ä¾èµ–

```bash
# å®‰è£…UIç»„ä»¶åº“
npm install uview-ui

# å®‰è£…çŠ¶æ€ç®¡ç†
npm install pinia

# å®‰è£…å…¶ä»–ä¾èµ–
npm install dayjs
```

### äº‘å‡½æ•°éƒ¨ç½²

#### 1. ä¸Šä¼ äº‘å‡½æ•°

```bash
# åœ¨HBuilderXä¸­å³é”®uniCloud/cloudfunctionsç›®å½•
# é€‰æ‹©"ä¸Šä¼ æ‰€æœ‰äº‘å‡½æ•°åŠå…¬å…±æ¨¡å—"

# æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œ
npx @dcloudio/uni-cloud-cli upload
```

#### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åœ¨HBuilderXä¸­å³é”®uniCloud/databaseç›®å½•
# é€‰æ‹©"åˆå§‹åŒ–äº‘æ•°æ®åº“"

# æˆ–è€…æ‰‹åŠ¨åœ¨uniCloudæ§åˆ¶å°åˆ›å»ºæ•°æ®è¡¨
```

### å‰ç«¯é…ç½®

#### 1. manifest.json é…ç½®

```json
{
  "name": "å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨",
  "appid": "__UNI__TODOAPP",
  "description": "ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨",
  "versionName": "1.0.0",
  "versionCode": "100",
  "transformPx": false,
  "app-plus": {
    "usingComponents": true,
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    },
    "modules": {},
    "distribute": {
      "android": {
        "permissions": [
          "<uses-permission android:name=\"android.permission.CHANGE_NETWORK_STATE\" />",
          "<uses-permission android:name=\"android.permission.MOUNT_UNMOUNT_FILESYSTEMS\" />",
          "<uses-permission android:name=\"android.permission.VIBRATE\" />",
          "<uses-permission android:name=\"android.permission.READ_LOGS\" />",
          "<uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\" />",
          "<uses-feature android:name=\"android.hardware.camera.autofocus\" />",
          "<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />",
          "<uses-permission android:name=\"android.permission.CAMERA\" />",
          "<uses-permission android:name=\"android.permission.GET_ACCOUNTS\" />",
          "<uses-permission android:name=\"android.permission.READ_PHONE_STATE\" />",
          "<uses-permission android:name=\"android.permission.CHANGE_WIFI_STATE\" />",
          "<uses-permission android:name=\"android.permission.WAKE_LOCK\" />",
          "<uses-permission android:name=\"android.permission.FLASHLIGHT\" />",
          "<uses-feature android:name=\"android.hardware.camera\" />",
          "<uses-permission android:name=\"android.permission.WRITE_SETTINGS\" />"
        ]
      },
      "ios": {},
      "sdkConfigs": {}
    }
  },
  "quickapp": {},
  "mp-weixin": {
    "appid": "",
    "setting": {
      "urlCheck": false
    },
    "usingComponents": true
  },
  "mp-alipay": {
    "usingComponents": true
  },
  "mp-baidu": {
    "usingComponents": true
  },
  "mp-toutiao": {
    "usingComponents": true
  },
  "uniStatistics": {
    "enable": false
  },
  "h5": {
    "title": "å¾…åŠäº‹é¡¹ç®¡ç†åº”ç”¨",
    "template": "index.html"
  }
}
```

#### 2. pages.json é…ç½®

```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "å¾…åŠäº‹é¡¹",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "pages/login/login",
      "style": {
        "navigationBarTitleText": "ç™»å½•"
      }
    },
    {
      "path": "pages/register/register",
      "style": {
        "navigationBarTitleText": "æ³¨å†Œ"
      }
    },
    {
      "path": "pages/tasks/tasks",
      "style": {
        "navigationBarTitleText": "ä»»åŠ¡ç®¡ç†"
      }
    },
    {
      "path": "pages/categories/categories",
      "style": {
        "navigationBarTitleText": "åˆ†ç±»ç®¡ç†"
      }
    },
    {
      "path": "pages/profile/profile",
      "style": {
        "navigationBarTitleText": "ä¸ªäººä¸­å¿ƒ"
      }
    }
  ],
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "å¾…åŠäº‹é¡¹",
    "navigationBarBackgroundColor": "#F8F8F8",
    "backgroundColor": "#F8F8F8"
  },
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#3cc51f",
    "borderStyle": "black",
    "backgroundColor": "#ffffff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "static/tab-home.png",
        "selectedIconPath": "static/tab-home-current.png",
        "text": "é¦–é¡µ"
      },
      {
        "pagePath": "pages/tasks/tasks",
        "iconPath": "static/tab-task.png",
        "selectedIconPath": "static/tab-task-current.png",
        "text": "ä»»åŠ¡"
      },
      {
        "pagePath": "pages/categories/categories",
        "iconPath": "static/tab-category.png",
        "selectedIconPath": "static/tab-category-current.png",
        "text": "åˆ†ç±»"
      },
      {
        "pagePath": "pages/profile/profile",
        "iconPath": "static/tab-profile.png",
        "selectedIconPath": "static/tab-profile-current.png",
        "text": "æˆ‘çš„"
      }
    ]
  },
  "condition": {
    "current": 0,
    "list": [
      {
        "name": "",
        "path": "",
        "query": ""
      }
    ]
  }
}
```

### å‘å¸ƒé…ç½®

#### 1. å¾®ä¿¡å°ç¨‹åºå‘å¸ƒ

```bash
# 1. åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æ³¨å†Œå°ç¨‹åº
# 2. è·å–AppIDå¹¶é…ç½®åˆ°manifest.json
# 3. åœ¨HBuilderXä¸­é€‰æ‹©"å‘è¡Œ" -> "å°ç¨‹åº-å¾®ä¿¡"
# 4. å¡«å†™AppIDå¹¶ç”Ÿæˆå°ç¨‹åºåŒ…
# 5. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸Šä¼ ä»£ç å¹¶æäº¤å®¡æ ¸
```

#### 2. H5 å‘å¸ƒ

```bash
# 1. åœ¨HBuilderXä¸­é€‰æ‹©"å‘è¡Œ" -> "ç½‘ç«™-H5æ‰‹æœºç‰ˆ"
# 2. é…ç½®åŸŸåå’ŒæœåŠ¡å™¨ä¿¡æ¯
# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–ä½¿ç”¨CDN
```

#### 3. App å‘å¸ƒ

```bash
# 1. åœ¨HBuilderXä¸­é€‰æ‹©"å‘è¡Œ" -> "åŸç”ŸApp-äº‘æ‰“åŒ…"
# 2. é…ç½®è¯ä¹¦å’Œç­¾å
# 3. é€‰æ‹©æ‰“åŒ…å¹³å°ï¼ˆAndroid/iOSï¼‰
# 4. ç­‰å¾…æ‰“åŒ…å®Œæˆå¹¶ä¸‹è½½å®‰è£…åŒ…
```

### è´¹ç”¨è¯´æ˜

#### uniCloud å…è´¹é¢åº¦

- **é˜¿é‡Œäº‘ç‰ˆ**ï¼š

  - äº‘å‡½æ•°ï¼š100 ä¸‡æ¬¡è°ƒç”¨/æœˆ
  - äº‘æ•°æ®åº“ï¼š1GB å­˜å‚¨ç©ºé—´
  - äº‘å­˜å‚¨ï¼š5GB å­˜å‚¨ç©ºé—´
  - CDNï¼š5GB æµé‡/æœˆ

- **è…¾è®¯äº‘ç‰ˆ**ï¼š
  - äº‘å‡½æ•°ï¼š100 ä¸‡æ¬¡è°ƒç”¨/æœˆ
  - äº‘æ•°æ®åº“ï¼š1GB å­˜å‚¨ç©ºé—´
  - äº‘å­˜å‚¨ï¼š5GB å­˜å‚¨ç©ºé—´

#### è¶…å‡ºå…è´¹é¢åº¦å

- æŒ‰å®é™…ä½¿ç”¨é‡ä»˜è´¹
- äº‘å‡½æ•°ï¼š0.0000133 å…ƒ/æ¬¡
- äº‘æ•°æ®åº“ï¼š0.07 å…ƒ/GB/å¤©
- äº‘å­˜å‚¨ï¼š0.0043 å…ƒ/GB/å¤©

---

## é¡¹ç›®äº®ç‚¹

### æŠ€æœ¯äº®ç‚¹

1. **è·¨å¹³å°å¼€å‘**: åŸºäº uni-appï¼Œä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼ˆå°ç¨‹åºã€H5ã€Appï¼‰
2. **äº‘åŸç”Ÿæ¶æ„**: ä½¿ç”¨ uniCloud äº‘æœåŠ¡ï¼Œæ— éœ€ç»´æŠ¤æœåŠ¡å™¨
3. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: Vue 3 + Pinia + uni-appï¼Œå¼€å‘æ•ˆç‡é«˜
4. **ç»„ä»¶åŒ–è®¾è®¡**: é«˜åº¦å¯å¤ç”¨çš„ Vue ç»„ä»¶
5. **å“åº”å¼è®¾è®¡**: å®Œç¾é€‚é…å„ç§å±å¹•å°ºå¯¸

### åŠŸèƒ½äº®ç‚¹

1. **æ™ºèƒ½æé†’**: æˆªæ­¢æ—¥æœŸæé†’ï¼Œé€¾æœŸä»»åŠ¡æ ‡è®°
2. **æ•°æ®ç»Ÿè®¡**: ä»»åŠ¡å®Œæˆç‡ã€åˆ†ç±»åˆ†å¸ƒç­‰å¯è§†åŒ–å›¾è¡¨
3. **æœç´¢ç­›é€‰**: å¤šç»´åº¦ä»»åŠ¡æœç´¢å’Œç­›é€‰
4. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡åˆ é™¤ã€çŠ¶æ€æ›´æ–°
5. **ç¦»çº¿ç¼“å­˜**: æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥

### æˆæœ¬ä¼˜åŠ¿

1. **å…è´¹é¢åº¦**: uniCloud æä¾›ä¸°å¯Œçš„å…è´¹é¢åº¦
2. **æŒ‰é‡ä»˜è´¹**: è¶…å‡ºå…è´¹é¢åº¦åæŒ‰å®é™…ä½¿ç”¨é‡ä»˜è´¹
3. **æ— éœ€è¿ç»´**: äº‘æœåŠ¡è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ— éœ€ç»´æŠ¤æœåŠ¡å™¨
4. **å¿«é€Ÿéƒ¨ç½²**: ä¸€é”®éƒ¨ç½²åˆ°å¤šä¸ªå¹³å°

### å¼€å‘ä¼˜åŠ¿

1. **å¼€å‘æ•ˆç‡**: äº‘ç«¯ä¸€ä½“åŒ–å¼€å‘ï¼Œå‰åç«¯ç»Ÿä¸€æŠ€æœ¯æ ˆ
2. **å®æ—¶é¢„è§ˆ**: HBuilderX æä¾›å®æ—¶é¢„è§ˆåŠŸèƒ½
3. **ä¸°å¯Œç”Ÿæ€**: æ’ä»¶å¸‚åœºæä¾›å¤§é‡ç°æˆç»„ä»¶
4. **æ–‡æ¡£å®Œå–„**: å®˜æ–¹æ–‡æ¡£è¯¦ç»†ï¼Œç¤¾åŒºæ´»è·ƒ
5. **å­¦ä¹ æˆæœ¬ä½**: åŸºäº Vue.jsï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“

### éƒ¨ç½²ä¼˜åŠ¿

1. **å¤šç«¯å‘å¸ƒ**: ä¸€æ¬¡å¼€å‘ï¼Œå¤šç«¯å‘å¸ƒ
2. **äº‘æ‰“åŒ…**: æ”¯æŒäº‘ç«¯æ‰“åŒ…ï¼Œæ— éœ€æœ¬åœ°é…ç½®ç¯å¢ƒ
3. **è‡ªåŠ¨æ›´æ–°**: æ”¯æŒçƒ­æ›´æ–°ï¼Œæ— éœ€é‡æ–°å‘å¸ƒ
4. **ç»Ÿè®¡åˆ†æ**: å†…ç½®ç»Ÿè®¡åˆ†æåŠŸèƒ½

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ç°ä»£äº‘åŸç”Ÿå¼€å‘çš„æœ€ä½³å®è·µï¼Œç‰¹åˆ«é€‚åˆä¸ªäººå¼€å‘è€…å’Œå°å›¢é˜Ÿå¿«é€Ÿæ„å»ºè·¨å¹³å°åº”ç”¨ã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œå¯ä»¥å±•ç¤ºä½ åœ¨å‰ç«¯å¼€å‘ã€äº‘æœåŠ¡ä½¿ç”¨ã€è·¨å¹³å°å¼€å‘ç­‰å¤šä¸ªæ–¹é¢çš„æŠ€æœ¯èƒ½åŠ›ï¼ŒåŒæ—¶å…·æœ‰å¾ˆå¥½çš„å•†ä¸šä»·å€¼å’Œå®ç”¨ä»·å€¼ã€‚
